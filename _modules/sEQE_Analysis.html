<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sEQE_Analysis &mdash; AFMDs sEQE setup October 2022 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/AFMD_placeholder.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../content/README.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content/hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content/usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control_generated/modules.html">sEQE-Control-Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis_generated/modules.html">sEQE-Analysis-Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content/contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content/licence.html">Acknowledgements and Linceses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AFMDs sEQE setup</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">sEQE_Analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sEQE_Analysis</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri Sep 28 11:59:40 2018</span>

<span class="sd">@author: Anna Jungbluth</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">filedialog</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
<span class="c1"># for the gui</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">linspace</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="kn">import</span> <span class="nn">sEQE_Analysis_template</span>
<span class="kn">from</span> <span class="nn">source.add_subtract</span> <span class="kn">import</span> <span class="n">subtract_Opt</span>
<span class="kn">from</span> <span class="nn">source.compilation</span> <span class="kn">import</span> <span class="n">compile_EQE</span><span class="p">,</span> <span class="n">compile_EL</span><span class="p">,</span> <span class="n">compile_Data</span>
<span class="kn">from</span> <span class="nn">source.electroluminescence</span> <span class="kn">import</span> <span class="n">bb_spectrum</span>
<span class="kn">from</span> <span class="nn">source.gaussian</span> <span class="kn">import</span> <span class="n">calculate_gaussian_absorption</span><span class="p">,</span> <span class="n">calculate_gaussian_disorder_absorption</span><span class="p">,</span> \
    <span class="n">calculate_MLJ_absorption</span><span class="p">,</span> <span class="n">calculate_MLJ_disorder_absorption</span><span class="p">,</span> <span class="n">calculate_combined_fit</span><span class="p">,</span> <span class="n">calculate_combined_fit_MLJ</span>
<span class="kn">from</span> <span class="nn">source.normalization</span> <span class="kn">import</span> <span class="n">normalize_EQE</span>
<span class="kn">from</span> <span class="nn">source.plot</span> <span class="kn">import</span> <span class="n">plot</span><span class="p">,</span> <span class="n">set_up_plot</span><span class="p">,</span> <span class="n">set_up_EQE_plot</span><span class="p">,</span> <span class="n">set_up_EL_plot</span>
<span class="kn">from</span> <span class="nn">source.reference_correction</span> <span class="kn">import</span> <span class="n">calculate_Power</span>
<span class="kn">from</span> <span class="nn">source.utils</span> <span class="kn">import</span> <span class="n">interpolate</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">,</span> <span class="n">get_logger</span>
<span class="kn">from</span> <span class="nn">source.utils_plot</span> <span class="kn">import</span> <span class="n">is_Colour</span><span class="p">,</span> <span class="n">pick_EQE_Color</span><span class="p">,</span> <span class="n">pick_EQE_Label</span><span class="p">,</span> <span class="n">pick_Label</span>
<span class="kn">from</span> <span class="nn">source.validity</span> <span class="kn">import</span> <span class="n">Ref_Data_is_valid</span><span class="p">,</span> <span class="n">EQE_is_valid</span><span class="p">,</span> <span class="n">Data_is_valid</span><span class="p">,</span> <span class="n">Normalization_is_valid</span><span class="p">,</span> <span class="n">Fit_is_valid</span><span class="p">,</span> \
    <span class="n">StartStop_is_valid</span>
<span class="kn">from</span> <span class="nn">source.utils_fit</span> <span class="kn">import</span> <span class="n">guess_fit</span><span class="p">,</span> <span class="n">fit_function</span><span class="p">,</span> <span class="n">calculate_guess_fit</span><span class="p">,</span> <span class="n">fit_model</span><span class="p">,</span> <span class="n">fit_model_double</span><span class="p">,</span> <span class="n">find_best_fit</span>
<span class="kn">from</span> <span class="nn">source.utils</span> <span class="kn">import</span> <span class="n">R_squared</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">RankWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ComplexWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s2">&quot;Intel MKL ERROR&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow">[docs]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Set up the user interface from Designer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">sEQE_Analysis_template</span><span class="o">.</span><span class="n">Ui_MainWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Tkinter</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>

        <span class="c1"># Logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>

        <span class="c1">## Page 1 - Calculate EQE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_4</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_5</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_6</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_4</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_5</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_6</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Browse Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_4</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_8</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_9</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_10</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_11</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_11</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_12</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p1_12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="c1"># Handle Calculate Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calculateButton_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calculateButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calculateButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calculateButton_4</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calculateButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calculateButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># Handle Export All Data Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">exportButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_EQE</span><span class="p">)</span>

        <span class="c1"># Handle Clear Plot Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">clearButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_plot</span><span class="p">)</span>

        <span class="c1">## Page 2 - Plot EQE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_4</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_5</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_6</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_7</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_8</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_9</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EQE_10</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import EQE Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_1</span><span class="p">,</span> <span class="s1">&#39;p1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_4</span><span class="p">,</span> <span class="s1">&#39;p4&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_7</span><span class="p">,</span> <span class="s1">&#39;p7&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_4</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_10</span><span class="p">,</span> <span class="s1">&#39;p10&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_13</span><span class="p">,</span> <span class="s1">&#39;p13&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_16</span><span class="p">,</span> <span class="s1">&#39;p16&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_19</span><span class="p">,</span> <span class="s1">&#39;p19&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_8</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_22</span><span class="p">,</span> <span class="s1">&#39;p22&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_9</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_25</span><span class="p">,</span> <span class="s1">&#39;p25&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseEQEButton_10</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_28</span><span class="p">,</span> <span class="s1">&#39;p28&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Plot EQE Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotEQEButton_Wavelength</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EQE</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotEQEButton_Energy</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EQE</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_label</span> <span class="o">=</span> <span class="s1">&#39;$\mathregular{C_</span><span class="si">{60}</span><span class="s1">}$&#39;</span>

        <span class="c1">## Page 3 - Fit EQE (Marcus Theory)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fit_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fit_2</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import EQE Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseFitButton_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f1</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseFitButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f4</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Gaussian Fit Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">gaussianFit_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_fit_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fit_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFit_1</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFit_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFitPlot_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFitPlot_1</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">gaussianFit_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_fit_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fit_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFit_2</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFit_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFitPlot_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFitPlot_2</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Handle Heat Map Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">heatButton_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fit_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStart_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStop_1</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStart_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStop_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f1</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">heatButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fit_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStart_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStop_2</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStart_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStop_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f4</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_f6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">clearButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_EQE_plot</span><span class="p">)</span>

        <span class="c1">## Page 4 - Extended Fits (Marcus Theory)</span>

        <span class="c1"># Double Fits</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_double</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import Data Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseDoubleFitButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_dF1</span><span class="p">,</span> <span class="s1">&#39;double1&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Double Fit Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">doubleFitButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_fit</span><span class="p">())</span>

        <span class="c1"># Simultaneous Peak Fitting</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bias_sim</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sim</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_sim</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import Data Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseSimFitButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_simFit</span><span class="p">,</span> <span class="s1">&#39;sim&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Sim Fit Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">simDoubleFitButton_single</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_double_fit_single</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">simDoubleFitButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_double_fit</span><span class="p">())</span>

        <span class="c1">## Page 5 - Fit EQE (MLJ Theory)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_xFit_1</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">S_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Huang_Rhys</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">vib_Energy</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="c1"># Handle Import EQE Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_extraFit</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_xF1</span><span class="p">,</span> <span class="s1">&#39;xF1&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Fit Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraFitButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_fit_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_xFit_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startExtraPlot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopExtraPlot</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startExtraFit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopExtraFit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startExtraFitPlot</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopExtraFitPlot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_xF1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_xF2</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_xF3</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Heat Map Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraHeatButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_xFit_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStartStart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStartStop</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStopStart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStopStop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_xF1</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_xF2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_xF3</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Clear Extra Fit Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">clearButton_extraFit</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_EQE_plot</span><span class="p">)</span>

        <span class="c1"># Double Fits</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_extraDouble</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import Data Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseButton_extraDoubleFit</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_extraDouble</span><span class="p">,</span> <span class="s1">&#39;xDF1&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Double Fit Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraDoubleFitButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_fit_MLJ</span><span class="p">())</span>

        <span class="c1">## Page 6 - Fit EL and EQE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EL_EQE</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Red_EL_cal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Red_EL_meas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Red_EQE_meas</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import EL and EQE Data Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseELButton_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_EL1</span><span class="p">,</span> <span class="s1">&#39;el1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseELButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_EL4</span><span class="p">,</span> <span class="s1">&#39;el2&#39;</span><span class="p">))</span>

        <span class="c1"># Handle EL Plot Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotELButton_1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_EL1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_EL1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Plot EL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotELButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_EL2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_EL2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># Plot Abs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotELButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL_EQE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_EQE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_EQE</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># Plot EQE</span>

        <span class="c1"># Handle Fit Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">fitButton_EL1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_EL1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_EL1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># Fit EL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">fitButton_EL2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_EL2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_EL2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># Fit Abs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">fitButton_EL3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_plot_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL_EQE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_EQE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_EQE</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                         <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># Fit EQE</span>

        <span class="c1"># Handle Clear EL Plot Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">clearButton_EL</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_EL_plot</span><span class="p">())</span>

        <span class="c1">## Page 7 - Subtract and Add Peak Fits</span>

        <span class="c1"># Subtract Peak Fits</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_subFit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_subEQE</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import Fit and EQE Data Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseSubButton_Fit</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_1</span><span class="p">,</span> <span class="s1">&#39;sub1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseSubButton_EQE</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_4</span><span class="p">,</span> <span class="s1">&#39;sub2&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Subtract Fit Data Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">subButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract_Fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_subFit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_subEQE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_5</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_6</span><span class="p">))</span>

        <span class="c1"># Add Peak Fits</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_addOptFit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_addCTFit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_addEQE</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle Import Fit and EQE Data Buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseAddButton_optFit</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_1</span><span class="p">,</span> <span class="s1">&#39;add1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseAddButton_CTFit</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_4</span><span class="p">,</span> <span class="s1">&#39;add2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">browseAddButton_EQE</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_7</span><span class="p">,</span> <span class="s1">&#39;add3&#39;</span><span class="p">))</span>

        <span class="c1"># Handle Plot Fit Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotAddButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_Fits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_addOptFit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_addCTFit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_addEQE</span><span class="p">))</span>

        <span class="c1"># Import Photodiode Calibration Files</span>

        <span class="n">Si_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span>
            <span class="s2">&quot;calibration_files/FDS100-CAL.xlsx&quot;</span><span class="p">)</span>  <span class="c1"># The files are in the sEQE Analysis folder, just as this program</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Si_cal</span> <span class="o">=</span> <span class="n">Si_file</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span>

        <span class="n">InGaAs_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s2">&quot;calibration_files/FGA21-CAL.xlsx&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InGaAs_cal</span> <span class="o">=</span> <span class="n">InGaAs_file</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span>

        <span class="c1"># Define Variables</span>

        <span class="c1"># NOTE: Modify path if switching from Linux to another operating system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)),</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="mf">6.626</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">)</span>  <span class="c1"># [m^2 kg/s]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_2</span> <span class="o">=</span> <span class="mf">4.136</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># [eV s]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="mf">2.998</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>  <span class="c1"># [m/s]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="mf">1.602</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">19</span><span class="p">)</span>  <span class="c1"># [C]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mf">8.617</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># [ev/K]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_EL</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Define parameters for initial guesses</span>
        <span class="c1"># NOTE: Modify initial guesses if fit is unsuccessful</span>
        <span class="c1"># NOTE: Some of these parameters are repeated/hard coded in utils_fit.py</span>

        <span class="c1"># These values are used in standard/disorder, Marcus/MLJ, EQE/EL fitting functions</span>
        <span class="c1"># Make sure to understand where the parameters all change if they are adjusted here!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span> <span class="o">=</span> <span class="mf">0.150</span>

        <span class="c1"># These values are used for disorder Marcus / MLJ fitting functions</span>
        <span class="c1"># self.bounds_sig = ([0, 0, 0, 0], [0.1, 0.4, 1.6, 0.2])  # f, l, E, sig</span>

        <span class="c1"># Normal Bounds:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds_sig</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>  <span class="c1"># f, l, E, sig</span>

        <span class="c1"># # Adjusted Bounds:</span>
        <span class="c1"># self.bounds_sig = ([0, 0, 0, 0], [0.1, 0.6, 1.7, 0.2])  # f, l, E, si</span>

        <span class="c1"># These values are used in the standard/disorder simultaneous double peak fitting</span>
        <span class="c1"># CAVEAT: I tried using the guess_fit function to test other guesses but didn&#39;t achieve great results</span>
        <span class="c1"># CAVEAT: The other fit functions start with an peak energy guess of 1.2 eV instead of 1.3 eV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>  <span class="c1"># fCT, lCT, ECT, fopt, lopt, Eopt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_guess_sig</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>  <span class="c1"># fCT, lCT, ECT, fopt, lopt, Eopt, sig</span>

        <span class="c1"># Set floating point precision</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># decimal places</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Functions to read file and update textbox</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MainWindow.writeText"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.writeText">[docs]</a>    <span class="k">def</span> <span class="nf">writeText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">text_Box</span><span class="p">,</span>
                  <span class="n">textBox_no</span>
                  <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to load data and update text box in GUI</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text_Box : gui object, required</span>
<span class="sd">            GUI text box to write filename into</span>
<span class="sd">        textBox_no : int or str, required</span>
<span class="sd">            GUI textbox with information on which variable to define</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
        <span class="n">file_</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">path_</span><span class="p">,</span> <span class="n">filename_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="n">text_Box</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear the text box in case sth has been uploaded already</span>
            <span class="n">text_Box</span><span class="o">.</span><span class="n">insertPlainText</span><span class="p">(</span><span class="n">filename_</span><span class="p">)</span>  <span class="c1"># Insert filename into text box</span>

            <span class="c1">## Page 1 - Calculate EQE</span>

            <span class="c1"># Reference files:</span>

            <span class="k">if</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>  <span class="c1"># Turn file into dataFrame</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1"># Data files:</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1">## Page 2 - Plot EQE</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p4&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p7&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p10&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p13&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p16&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p19&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_7</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p22&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_8</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p25&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_9</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;p28&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EQE_10</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1">## Page 3 - Fit EQE (Marcus Theory)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;f1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_fit_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;f4&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_fit_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1">## Page 4 - Extended Fits (Marcus Theory)</span>

            <span class="c1"># For Double Fits</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;double1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_double</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1"># For Simultaneous Fits</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;sim&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1">## Page 5 - Fit EQE (MLJ Theory)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;xF1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_xFit_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;xDF1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_extraDouble</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1">## Page 6 - Fit EL and EQE</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;el1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">file_</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;el2&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EL_EQE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1">## Page 7 - Subtract and Add Peak Fits</span>

            <span class="c1"># Subtract Peak Fits</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;sub1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_subFit</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;sub2&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_subEQE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1"># Add Peak Fits</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;add1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_addOptFit</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;add2&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_addCTFit</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">textBox_no</span> <span class="o">==</span> <span class="s1">&#39;add3&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_addEQE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Page 1 - Calculate EQE</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to select data and reference files</span>

<div class="viewcode-block" id="MainWindow.pre_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.pre_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">pre_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">ref_df</span><span class="p">,</span>
                <span class="n">data_df</span><span class="p">,</span>
                <span class="n">start</span><span class="p">,</span>
                <span class="n">stop</span><span class="p">,</span>
                <span class="n">range_no</span>
                <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper function to load variables and data for EQE calculation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_df : dataFrame, required</span>
<span class="sd">            Dataframe with reference diode measurement</span>
<span class="sd">        data_df : dataFrame, required</span>
<span class="sd">            Dataframe with sample measurement</span>
<span class="sd">        start : gui object, required</span>
<span class="sd">            GUI field with start wavelength</span>
<span class="sd">        stop : gui object, required</span>
<span class="sd">            GUI field with stop wavelength</span>
<span class="sd">        range_no : int, required</span>
<span class="sd">            Number specifying which data range to compile</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">startNM</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stopNM</span> <span class="o">=</span> <span class="n">stop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">Ref_Data_is_valid</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="n">data_df</span><span class="p">,</span> <span class="n">startNM</span><span class="p">,</span> <span class="n">stopNM</span><span class="p">,</span> <span class="n">range_no</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_EQE</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="n">data_df</span><span class="p">,</span> <span class="n">startNM</span><span class="p">,</span> <span class="n">stopNM</span><span class="p">,</span> <span class="n">range_no</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to calculate EQE</span>

<div class="viewcode-block" id="MainWindow.calculate_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.calculate_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">ref_df</span><span class="p">,</span>
                      <span class="n">data_df</span><span class="p">,</span>
                      <span class="n">startNM</span><span class="p">,</span>
                      <span class="n">stopNM</span><span class="p">,</span>
                      <span class="n">range_no</span>
                      <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to calculate EQE from signal and reference data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_df : dataFrame, required</span>
<span class="sd">            Dataframe with reference diode measurement</span>
<span class="sd">        data_df : dataFrame, required</span>
<span class="sd">            Dataframe with sample measurement</span>
<span class="sd">        startNM : float, required</span>
<span class="sd">            Start wavelength [nm]</span>
<span class="sd">        stop : float, required</span>
<span class="sd">            Stop wavelength [nm]</span>
<span class="sd">        range_no : int, required</span>
<span class="sd">            Number specifying which data range to compile</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">power_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Wavelength</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Energy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">EQE</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">log_EQE</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;Power&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating power values.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">range_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range1_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range1_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range1_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range1_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InGaAs_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">range_no</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range2_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range2_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range2_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range2_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InGaAs_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">range_no</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range3_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range3_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range3_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range3_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InGaAs_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">range_no</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range4_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range4_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range4_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range4_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InGaAs_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">range_no</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range5_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range5_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range5_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range5_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InGaAs_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">range_no</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range6_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range6_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range6_InGaAs_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Range6_Si_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_Power</span><span class="p">(</span><span class="n">ref_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">InGaAs_cal</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid reference diode.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;Power&#39;</span> <span class="ow">in</span> <span class="n">ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>  <span class="c1"># Check if the power has been calculated already</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">])):</span>  <span class="c1"># Iterate through columns of reference file</span>
                <span class="n">power_dict</span><span class="p">[</span><span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">][</span>
                    <span class="n">x</span><span class="p">]</span>  <span class="c1"># Add wavelength and corresponding power to dictionary</span>

            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">])):</span>  <span class="c1"># Iterate through columns of data file</span>
                <span class="k">if</span> <span class="n">startNM</span> <span class="o">&lt;=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">stopNM</span><span class="p">:</span>  <span class="c1"># Calculate EQE if start &lt;= wave &lt;= stop, else ignore</span>

                    <span class="k">if</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="ow">in</span> <span class="n">power_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># Check if data wavelength is in reference file</span>
                        <span class="n">Wavelength</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                        <span class="n">Energy_val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                                <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>  <span class="c1"># Calculate energy in eV</span>
                        <span class="n">Energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Energy_val</span><span class="p">)</span>
                        <span class="n">EQE_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Mean Current&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">Energy_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                            <span class="n">power_dict</span><span class="p">[</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]])</span>  <span class="c1"># Easier way to calculate EQE</span>
                        <span class="c1"># EQE_val = ((data_df[&#39;Mean Current&#39;][y] * self.h * self.c) / (</span>
                        <span class="c1">#   data_df[&#39;Wavelength&#39;][y] * math.pow(10,-9) * power_dict[data_df[&#39;Wavelength&#39;][y]] * self.q))</span>
                        <span class="c1"># EQE_val = (100 * data_df[&#39;Mean Current&#39;][y] * Energy_val) / (</span>
                        <span class="c1">#   power_dict[data_df[&#39;Wavelength&#39;][y]]) # *100 to turn into percent</span>
                        <span class="n">EQE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EQE_val</span><span class="p">)</span>
                        <span class="n">log_EQE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">EQE_val</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># If data wavelength is not in reference file</span>
                        <span class="n">Wavelength</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                        <span class="n">Energy_val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
                        <span class="n">Energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Energy_val</span><span class="p">)</span>
                        <span class="n">Power_int</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span> <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">],</span>
                                                <span class="n">ref_df</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">])</span>  <span class="c1"># Interpolate power</span>
                        <span class="n">EQE_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Mean Current&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">Energy_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Power_int</span><span class="p">)</span>
                        <span class="c1"># EQE_int = ((data_df[&#39;Mean Current&#39;][y] * self.h * self.c) / (</span>
                        <span class="c1">#         data_df[&#39;Wavelength&#39;][y] * math.pow(10,-9) * Power_int * self.q))</span>
                        <span class="n">EQE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EQE_int</span><span class="p">)</span>
                        <span class="n">log_EQE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">EQE_int</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Wavelength</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">EQE</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Energy</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_EQE</span><span class="p">):</span>  <span class="c1"># Check if the lists have the same length</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span><span class="p">:</span>  <span class="c1"># If the &quot;Export Data&quot; button has been clicked</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">Wavelength</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EQE</span><span class="p">,</span> <span class="n">log_EQE</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># If the &quot;Calculate EQE&quot; button has been clicked</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot</span><span class="p">:</span>  <span class="c1"># This is set to true during setup of the program</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">set_up_plot</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_plot</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Set self.do_plot to False to plot on the same graph</span>

                <span class="n">label_</span> <span class="o">=</span> <span class="n">pick_Label</span><span class="p">(</span><span class="n">range_no</span><span class="p">,</span> <span class="n">startNM</span><span class="p">,</span> <span class="n">stopNM</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Wavelength</span><span class="p">,</span> <span class="n">EQE</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Wavelength</span><span class="p">,</span> <span class="n">EQE</span><span class="p">,</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Equivalent to the line above but with proper log scale axes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Length mismatch.&#39;</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to export EQE</span>

<div class="viewcode-block" id="MainWindow.export_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.export_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">export_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to export EQE to csv file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">ok_1</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Create boolean variable to use for &quot;is_valid&quot; function</span>
        <span class="n">ok_2</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_3</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_4</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_5</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_6</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;EQE&#39;</span><span class="p">,</span> <span class="s1">&#39;Log_EQE&#39;</span><span class="p">]</span>  <span class="c1"># Columns for dataFrame</span>

        <span class="n">export_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>  <span class="c1"># Create empty dataFrame</span>

        <span class="n">wave_inc</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># create empty dictionary</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">exportBox_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>  <span class="c1"># If the checkBox is checked</span>
            <span class="n">startNM1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick start wavelength</span>
            <span class="n">stopNM1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick stop wavelength</span>
            <span class="k">if</span> <span class="n">Ref_Data_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_1</span><span class="p">,</span> <span class="n">startNM1</span><span class="p">,</span> <span class="n">stopNM1</span><span class="p">,</span>
                                 <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Check that files are non-empty and within wavelength range</span>
                <span class="n">Wave_1</span><span class="p">,</span> <span class="n">Energy_1</span><span class="p">,</span> <span class="n">EQE_1</span><span class="p">,</span> <span class="n">log_EQE_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_1</span><span class="p">,</span> <span class="n">startNM1</span><span class="p">,</span> <span class="n">stopNM1</span><span class="p">,</span>
                                                                        <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Extract data</span>
                <span class="n">export_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">:</span> <span class="n">Wave_1</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">:</span> <span class="n">Energy_1</span><span class="p">,</span> <span class="s1">&#39;EQE&#39;</span><span class="p">:</span> <span class="n">EQE_1</span><span class="p">,</span>
                                         <span class="s1">&#39;Log_EQE&#39;</span><span class="p">:</span> <span class="n">log_EQE_1</span><span class="p">})</span>  <span class="c1"># Create dataFrame with EQE data</span>
                <span class="n">wave_inc</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wave_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Add the first wavelength value to the wave_inc list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ok_1</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Set variable to False if calculation is invalid</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">exportBox_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">startNM2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">stopNM2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Ref_Data_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_2</span><span class="p">,</span> <span class="n">startNM2</span><span class="p">,</span> <span class="n">stopNM2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">Wave_2</span><span class="p">,</span> <span class="n">Energy_2</span><span class="p">,</span> <span class="n">EQE_2</span><span class="p">,</span> <span class="n">log_EQE_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_2</span><span class="p">,</span> <span class="n">startNM2</span><span class="p">,</span> <span class="n">stopNM2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">export_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">:</span> <span class="n">Wave_2</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">:</span> <span class="n">Energy_2</span><span class="p">,</span> <span class="s1">&#39;EQE&#39;</span><span class="p">:</span> <span class="n">EQE_2</span><span class="p">,</span> <span class="s1">&#39;Log_EQE&#39;</span><span class="p">:</span> <span class="n">log_EQE_2</span><span class="p">})</span>
                <span class="n">wave_inc</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wave_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ok_2</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">exportBox_3</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">startNM3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_3</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">stopNM3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_3</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Ref_Data_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_3</span><span class="p">,</span> <span class="n">startNM3</span><span class="p">,</span> <span class="n">stopNM3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">Wave_3</span><span class="p">,</span> <span class="n">Energy_3</span><span class="p">,</span> <span class="n">EQE_3</span><span class="p">,</span> <span class="n">log_EQE_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_3</span><span class="p">,</span> <span class="n">startNM3</span><span class="p">,</span> <span class="n">stopNM3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">export_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">:</span> <span class="n">Wave_3</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">:</span> <span class="n">Energy_3</span><span class="p">,</span> <span class="s1">&#39;EQE&#39;</span><span class="p">:</span> <span class="n">EQE_3</span><span class="p">,</span> <span class="s1">&#39;Log_EQE&#39;</span><span class="p">:</span> <span class="n">log_EQE_3</span><span class="p">})</span>
                <span class="n">wave_inc</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wave_3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ok_3</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">exportBox_4</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">startNM4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_4</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">stopNM4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_4</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Ref_Data_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_4</span><span class="p">,</span> <span class="n">startNM4</span><span class="p">,</span> <span class="n">stopNM4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">Wave_4</span><span class="p">,</span> <span class="n">Energy_4</span><span class="p">,</span> <span class="n">EQE_4</span><span class="p">,</span> <span class="n">log_EQE_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_4</span><span class="p">,</span> <span class="n">startNM4</span><span class="p">,</span> <span class="n">stopNM4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">export_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">:</span> <span class="n">Wave_4</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">:</span> <span class="n">Energy_4</span><span class="p">,</span> <span class="s1">&#39;EQE&#39;</span><span class="p">:</span> <span class="n">EQE_4</span><span class="p">,</span> <span class="s1">&#39;Log_EQE&#39;</span><span class="p">:</span> <span class="n">log_EQE_4</span><span class="p">})</span>
                <span class="n">wave_inc</span><span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wave_4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ok_4</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">exportBox_5</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">startNM5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_5</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">stopNM5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_5</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Ref_Data_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_5</span><span class="p">,</span> <span class="n">startNM5</span><span class="p">,</span> <span class="n">stopNM5</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                <span class="n">Wave_5</span><span class="p">,</span> <span class="n">Energy_5</span><span class="p">,</span> <span class="n">EQE_5</span><span class="p">,</span> <span class="n">log_EQE_5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_5</span><span class="p">,</span> <span class="n">startNM5</span><span class="p">,</span> <span class="n">stopNM5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">export_5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">:</span> <span class="n">Wave_5</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">:</span> <span class="n">Energy_5</span><span class="p">,</span> <span class="s1">&#39;EQE&#39;</span><span class="p">:</span> <span class="n">EQE_5</span><span class="p">,</span> <span class="s1">&#39;Log_EQE&#39;</span><span class="p">:</span> <span class="n">log_EQE_5</span><span class="p">})</span>
                <span class="n">wave_inc</span><span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wave_5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ok_5</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">exportBox_6</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">startNM6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startNM_6</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">stopNM6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopNM_6</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Ref_Data_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_6</span><span class="p">,</span> <span class="n">startNM6</span><span class="p">,</span> <span class="n">stopNM6</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                <span class="n">Wave_6</span><span class="p">,</span> <span class="n">Energy_6</span><span class="p">,</span> <span class="n">EQE_6</span><span class="p">,</span> <span class="n">log_EQE_6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_6</span><span class="p">,</span> <span class="n">startNM6</span><span class="p">,</span> <span class="n">stopNM6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="n">export_6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">:</span> <span class="n">Wave_6</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">:</span> <span class="n">Energy_6</span><span class="p">,</span> <span class="s1">&#39;EQE&#39;</span><span class="p">:</span> <span class="n">EQE_6</span><span class="p">,</span> <span class="s1">&#39;Log_EQE&#39;</span><span class="p">:</span> <span class="n">log_EQE_6</span><span class="p">})</span>
                <span class="n">wave_inc</span><span class="p">[</span><span class="s1">&#39;6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wave_6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ok_6</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">ok_1</span> <span class="ow">and</span> <span class="n">ok_2</span> <span class="ow">and</span> <span class="n">ok_3</span> <span class="ow">and</span> <span class="n">ok_4</span> <span class="ow">and</span> <span class="n">ok_5</span> <span class="ow">and</span> <span class="n">ok_6</span><span class="p">:</span>  <span class="c1"># Check if all operations are ok or if fields are empty</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave_inc</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>  <span class="c1"># Iterate through wave_inc list</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">wave_inc</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">wave_inc</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>  <span class="c1"># Find key corresponding to minimum value</span>
                <span class="k">if</span> <span class="n">minimum</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>  <span class="c1"># Append correct dataFrame in order of decending wavelength</span>
                    <span class="n">export_file</span> <span class="o">=</span> <span class="n">export_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">export_1</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">minimum</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
                    <span class="n">export_file</span> <span class="o">=</span> <span class="n">export_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">export_2</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">minimum</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
                    <span class="n">export_file</span> <span class="o">=</span> <span class="n">export_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">export_3</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">minimum</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
                    <span class="n">export_file</span> <span class="o">=</span> <span class="n">export_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">export_4</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">minimum</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
                    <span class="n">export_file</span> <span class="o">=</span> <span class="n">export_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">export_5</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">minimum</span> <span class="o">==</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span>
                    <span class="n">export_file</span> <span class="o">=</span> <span class="n">export_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">export_6</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">del</span> <span class="n">wave_inc</span><span class="p">[</span><span class="n">minimum</span><span class="p">]</span>  <span class="c1"># Delete recently appended value</span>

            <span class="n">EQE_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># Prompt the user to pick a folder &amp; name to save data to</span>
            <span class="n">export_path</span><span class="p">,</span> <span class="n">export_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">EQE_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">export_path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check if the user actually selected a path</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">export_path</span><span class="p">)</span>  <span class="c1"># Change the working directory</span>
                <span class="n">export_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">export_filename</span><span class="p">)</span>  <span class="c1"># Save data to csv</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving data to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">EQE_file</span><span class="p">))</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>  <span class="c1"># Change the directory back</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Page 2 - Calculate EQE</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to select EQE for plotting</span>

<div class="viewcode-block" id="MainWindow.pre_plot_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.pre_plot_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">pre_plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">number</span>
                     <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper function to select EQE file for plotting</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int, required</span>
<span class="sd">            Number of the EQE file to plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ok_EQE_1</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_2</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_3</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_4</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_5</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_6</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_7</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_8</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_9</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ok_EQE_10</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">normalizeBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">norm_num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm_num</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_2</span> <span class="o">=</span> <span class="n">set_up_EQE_plot</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">norm_num</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_1</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_4</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_3</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_7</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_4</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_10</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_12</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_5</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_13</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_14</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_6</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_16</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_17</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_18</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_7</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_7</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_19</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_21</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_8</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_22</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_24</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_9</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_9</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_25</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_26</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_27</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plotBox_10</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">ok_EQE_10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EQE_10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startEQE_10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopEQE_10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_28</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_29</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p2_30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ok_EQE_1</span> <span class="ow">and</span> <span class="n">ok_EQE_2</span> <span class="ow">and</span> <span class="n">ok_EQE_3</span> <span class="ow">and</span> <span class="n">ok_EQE_4</span> <span class="ow">and</span> <span class="n">ok_EQE_5</span> <span class="ow">and</span> <span class="n">ok_EQE_6</span> <span class="ow">and</span> <span class="n">ok_EQE_7</span> <span class="ow">and</span> <span class="n">ok_EQE_8</span> <span class="ow">and</span> \
                <span class="n">ok_EQE_9</span> <span class="ow">and</span> <span class="n">ok_EQE_10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="c1"># self.axEQE_1.legend(frameon=False, fontsize=13) # Adjusted style</span>
            <span class="c1"># self.axEQE_2.legend(frameon=False, fontsize=13) # Adjusted style</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to plot EQE</span>

<div class="viewcode-block" id="MainWindow.plot_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.plot_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">plot_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">eqe_df</span><span class="p">,</span>
                 <span class="n">startNM</span><span class="p">,</span>
                 <span class="n">stopNM</span><span class="p">,</span>
                 <span class="n">filename_Box</span><span class="p">,</span>
                 <span class="n">label_Box</span><span class="p">,</span>
                 <span class="n">color_Box</span><span class="p">,</span>
                 <span class="n">file_no</span><span class="p">,</span>
                 <span class="n">number</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to plot EQE data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eqe_df : dataFrame, required</span>
<span class="sd">            Dataframe with EQE data</span>
<span class="sd">        startNM : float, required</span>
<span class="sd">            Start wavelength [nm]</span>
<span class="sd">        stop : float, required</span>
<span class="sd">            Stop wavelength [nm]</span>
<span class="sd">        filename_Box : gui object, required</span>
<span class="sd">            GUI textbox with filename information for plot labeling</span>
<span class="sd">        label_Box : gui object, required</span>
<span class="sd">            GUI textbox with plot label</span>
<span class="sd">        color_Box : gui object, required</span>
<span class="sd">            GUI textbox with plot color</span>
<span class="sd">        file_no : int, required</span>
<span class="sd">            Number of EQE file/data range to plot</span>
<span class="sd">        number : int, required</span>
<span class="sd">            Number specifying whether to plot wavelength or energy</span>
<span class="sd">            0 -&gt; Wavelength</span>
<span class="sd">            1 -&gt; Energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">startNM</span> <span class="o">=</span> <span class="n">startNM</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick start wavelength</span>
        <span class="n">stopNM</span> <span class="o">=</span> <span class="n">stopNM</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick stop wavelength</span>

        <span class="k">if</span> <span class="n">EQE_is_valid</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span> <span class="n">startNM</span><span class="p">,</span> <span class="n">stopNM</span><span class="p">,</span> <span class="n">file_no</span><span class="p">):</span>  <span class="c1"># Check that files are non-empty and within wavelength range</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">normalizeBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">normNM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">normalizeNM</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">Normalization_is_valid</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span> <span class="n">normNM</span><span class="p">,</span> <span class="n">file_no</span><span class="p">):</span>
                    <span class="n">wave</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">eqe</span><span class="p">,</span> <span class="n">log_eqe</span> <span class="o">=</span> <span class="n">normalize_EQE</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span> <span class="n">startNM</span><span class="p">,</span> <span class="n">stopNM</span><span class="p">,</span> <span class="n">normNM</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wave</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">eqe</span><span class="p">,</span> <span class="n">log_eqe</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span> <span class="n">startNM</span><span class="p">,</span> <span class="n">stopNM</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">label_</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="n">label_Box</span><span class="p">,</span> <span class="n">filename_Box</span><span class="p">)</span>
            <span class="n">color_</span> <span class="o">=</span> <span class="n">pick_EQE_Color</span><span class="p">(</span><span class="n">color_Box</span><span class="p">,</span> <span class="n">file_no</span><span class="p">)</span>

            <span class="n">ls_</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>

            <span class="k">if</span> <span class="n">label_</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_label</span><span class="p">:</span>
                <span class="n">ls_</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span>

            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">eqe</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">eqe</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">eqe</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axEQE_2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">eqe</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">ls_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Page 3 - Fit EQE (Marcus Theory)</span>
    <span class="c1"># Page 5 - Fit EQE (MLJ Theory)</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to select EQE to fit</span>

<div class="viewcode-block" id="MainWindow.pre_fit_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.pre_fit_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">pre_fit_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">eqe_df</span><span class="p">,</span>
                    <span class="n">startE</span><span class="p">,</span>
                    <span class="n">stopE</span><span class="p">,</span>
                    <span class="n">startFit</span><span class="p">,</span>
                    <span class="n">stopFit</span><span class="p">,</span>
                    <span class="n">startPlotFit</span><span class="p">,</span>
                    <span class="n">stopPlotFit</span><span class="p">,</span>
                    <span class="n">filename_Box</span><span class="p">,</span>
                    <span class="n">label_Box</span><span class="p">,</span>
                    <span class="n">color_Box</span><span class="p">,</span>
                    <span class="n">file_no</span>
                    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper function to fit EQE spectrum</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eqe_df : DataFrame, required</span>
<span class="sd">            Dataframe with EQE data</span>
<span class="sd">        startE : float, required</span>
<span class="sd">            Start energy to plot EQE</span>
<span class="sd">        stopE : float, required</span>
<span class="sd">            Stop energy to plot EQE</span>
<span class="sd">        startFit : float, required</span>
<span class="sd">            Start energy to fit</span>
<span class="sd">        stopFit : float, required</span>
<span class="sd">            Stop energy to fit</span>
<span class="sd">        startPlotFit : float, required</span>
<span class="sd">            Start energy to plot fit</span>
<span class="sd">        stopPlotFit : float, required</span>
<span class="sd">            Stop energy to plot fit</span>
<span class="sd">        filename_Box : gui object, required</span>
<span class="sd">            GUI text box with filename to use for plot labeling</span>
<span class="sd">        label_Box : gui object, required</span>
<span class="sd">            GUI text box with plot label</span>
<span class="sd">        color_Box : gui object, required</span>
<span class="sd">            GUI text box with plot color</span>
<span class="sd">        file_no : int, required</span>
<span class="sd">            Number of EQE file to plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Change this if you want to plot on the same graph </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span> <span class="o">=</span> <span class="n">set_up_EQE_plot</span><span class="p">()</span>  <span class="c1"># Sets up plot of energy vs EQE / log(EQE)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_plot</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">ok_plot_Fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_fit_EQE</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span>
                                        <span class="n">startE</span><span class="p">,</span>
                                        <span class="n">stopE</span><span class="p">,</span>
                                        <span class="n">startFit</span><span class="p">,</span>
                                        <span class="n">stopFit</span><span class="p">,</span>
                                        <span class="n">startPlotFit</span><span class="p">,</span>
                                        <span class="n">stopPlotFit</span><span class="p">,</span>
                                        <span class="n">filename_Box</span><span class="p">,</span>
                                        <span class="n">label_Box</span><span class="p">,</span>
                                        <span class="n">color_Box</span><span class="p">,</span>
                                        <span class="n">file_no</span>
                                        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ok_plot_Fit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to fit and plot EQE</span>

<div class="viewcode-block" id="MainWindow.plot_fit_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.plot_fit_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">plot_fit_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">eqe_df</span><span class="p">,</span>
                     <span class="n">startE</span><span class="p">,</span>
                     <span class="n">stopE</span><span class="p">,</span>
                     <span class="n">startFit</span><span class="p">,</span>
                     <span class="n">stopFit</span><span class="p">,</span>
                     <span class="n">startPlotFit</span><span class="p">,</span>
                     <span class="n">stopPlotFit</span><span class="p">,</span>
                     <span class="n">filename_Box</span><span class="p">,</span>
                     <span class="n">label_Box</span><span class="p">,</span>
                     <span class="n">color_Box</span><span class="p">,</span>
                     <span class="n">file_no</span>
                     <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to fit and plot EQE</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eqe_df : DataFrame, required</span>
<span class="sd">            Dataframe with EQE data</span>
<span class="sd">        startE : float, required</span>
<span class="sd">            Start energy to plot EQE</span>
<span class="sd">        stopE : float, required</span>
<span class="sd">            Stop energy to plot EQE</span>
<span class="sd">        startFit : float, required</span>
<span class="sd">            Start energy to fit</span>
<span class="sd">        stopFit : float, required</span>
<span class="sd">            Stop energy to fit</span>
<span class="sd">        startPlotFit : float, required</span>
<span class="sd">            Start energy to plot fit</span>
<span class="sd">        stopPlotFit : float, required</span>
<span class="sd">            Stop energy to plot fit</span>
<span class="sd">        filename_Box : gui object, required</span>
<span class="sd">            GUI text box with filename to use for plot labeling</span>
<span class="sd">        label_Box : gui object, required</span>
<span class="sd">            GUI text box with plot label</span>
<span class="sd">        color_Box : gui object, required</span>
<span class="sd">            GUI text box with plot color</span>
<span class="sd">        file_no : int, required</span>
<span class="sd">            Number of EQE file to plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Bool :</span>
<span class="sd">            True if fit is successful, </span>
<span class="sd">            False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">fit_opticalPeak</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">fit_ok</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">startE</span> <span class="o">=</span> <span class="n">startE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick start energy</span>
        <span class="n">stopE</span> <span class="o">=</span> <span class="n">stopE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick stop energy</span>

        <span class="n">startFit</span> <span class="o">=</span> <span class="n">startFit</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick start fit energy</span>
        <span class="n">stopFit</span> <span class="o">=</span> <span class="n">stopFit</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>  <span class="c1"># Pick stop fit energy</span>

        <span class="n">startPlotFit</span> <span class="o">=</span> <span class="n">startPlotFit</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stopPlotFit</span> <span class="o">=</span> <span class="n">stopPlotFit</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">Fit_is_valid</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span> <span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">,</span> <span class="n">startFit</span><span class="p">,</span> <span class="n">stopFit</span><span class="p">,</span> <span class="n">file_no</span><span class="p">):</span>  <span class="c1"># Check if files are not empty and in range</span>
            <span class="n">wave</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">eqe</span><span class="p">,</span> <span class="n">log_eqe</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span> <span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Compile EQE file</span>
            <span class="n">wave_fit</span><span class="p">,</span> <span class="n">energy_fit</span><span class="p">,</span> <span class="n">eqe_fit</span><span class="p">,</span> <span class="n">log_eqe_fit</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span> <span class="n">startFit</span><span class="p">,</span> <span class="n">stopFit</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Compile fit range</span>

            <span class="n">label_</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="n">label_Box</span><span class="p">,</span> <span class="n">filename_Box</span><span class="p">)</span>
            <span class="n">color_</span> <span class="o">=</span> <span class="n">pick_EQE_Color</span><span class="p">(</span><span class="n">color_Box</span><span class="p">,</span> <span class="n">file_no</span><span class="p">)</span>

            <span class="c1"># Fit EQE (Marcus Theory)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_no</span><span class="p">))</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">file_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Data in first row</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Temperature_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStart_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStop_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStartSig_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStopSig_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>  <span class="c1"># Check peak to fit</span>
                        <span class="n">fit_opticalPeak</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">file_no</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Data in second row</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Temperature_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStart_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStop_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStartSig_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStopSig_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">fit_opticalPeak</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>

                <span class="c1"># Attempt peak fit:</span>
                <span class="n">x_gaussian</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">startPlotFit</span><span class="p">,</span> <span class="n">stopPlotFit</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

                <span class="n">ECT_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">guessStart</span><span class="p">,</span> <span class="n">guessStop</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="c1"># Sig_guess = np.round(np.arange(guessStart_sig, guessStop_sig + 0.05, 0.05), 3).tolist()</span>
                <span class="n">Sig_guess</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">guessStart_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">guessStop_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

                <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                    <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe_df</span><span class="p">,</span>
                                                                <span class="n">startE</span><span class="o">=</span><span class="n">startFit</span><span class="p">,</span>
                                                                <span class="n">stopE</span><span class="o">=</span><span class="n">stopFit</span><span class="p">,</span>
                                                                <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder</span><span class="p">,</span>
                                                                <span class="n">guessRange</span><span class="o">=</span><span class="n">ECT_guess</span><span class="p">,</span>
                                                                <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">Sig_guess</span><span class="p">,</span>
                                                                <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># to use fit model instead of fit function</span>
                                                                <span class="p">)</span>

                    <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                             <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                             <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                             <span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                                             <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                        <span class="n">fit_ok</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># If disorder is not included</span>
                    <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe_df</span><span class="p">,</span>
                                                                <span class="n">startE</span><span class="o">=</span><span class="n">startFit</span><span class="p">,</span>
                                                                <span class="n">stopE</span><span class="o">=</span><span class="n">stopFit</span><span class="p">,</span>
                                                                <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian</span><span class="p">,</span>
                                                                <span class="n">guessRange</span><span class="o">=</span><span class="n">ECT_guess</span><span class="p">,</span>
                                                                <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">Sig_guess</span><span class="p">,</span>
                                                                <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function instead of fit model</span>
                                                                <span class="p">)</span>

                    <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                    <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                    <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                        <span class="n">fit_ok</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">fit_ok</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initial Guess (eV) : &#39;</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature [T] (K) : &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Oscillator Strength [f] (eV**2) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reorganization Energy [l] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">fit_opticalPeak</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optical Peak Energy [E_Opt] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CT State Energy [ECT] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sigma (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                        <span class="n">W</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">+</span> <span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gaussian Variance [W] (eV K) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">))</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2 : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">r_squared</span><span class="p">,</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="c1"># Plot EQE data and CT fit</span>
                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="n">fit_label</span> <span class="o">=</span> <span class="s1">&#39;Gaussian Fit + Disorder&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fit_label</span> <span class="o">=</span> <span class="s1">&#39;Gaussian Fit&#39;</span>

                    <span class="k">if</span> <span class="n">fit_opticalPeak</span><span class="p">:</span>
                        <span class="n">fit_linestyle</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fit_linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span>
                                      <span class="n">eqe</span><span class="p">,</span>
                                      <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                      <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="n">color_</span>
                                      <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                      <span class="n">y_gaussian</span><span class="p">,</span>
                                      <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">label</span><span class="o">=</span><span class="n">fit_label</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                      <span class="n">linestyle</span><span class="o">=</span><span class="n">fit_linestyle</span>
                                      <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span>
                                          <span class="n">eqe</span><span class="p">,</span>
                                          <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="n">color_</span>
                                          <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                      <span class="n">y_gaussian</span><span class="p">,</span>
                                      <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">label</span><span class="o">=</span><span class="n">fit_label</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                      <span class="n">linestyle</span><span class="o">=</span><span class="n">fit_linestyle</span>
                                      <span class="p">)</span>

                    <span class="c1"># Save fit data</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_gaussianFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">fit_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                        <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_gaussian</span>
                        <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_gaussian</span>
                        <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span>
                        <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">fit_opticalPeak</span><span class="p">:</span>
                            <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Optical Peak Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;CT State Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                            <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Sigma (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                        <span class="n">save_fit_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># User to pick folder &amp; name to save to</span>
                        <span class="n">save_fit_path</span><span class="p">,</span> <span class="n">save_fit_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">save_fit_file</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">save_fit_path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check if the user actually selected a path</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">save_fit_path</span><span class="p">)</span>  <span class="c1"># Change the working directory</span>
                            <span class="n">fit_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_fit_filename</span><span class="p">)</span>  <span class="c1"># Save data to csv</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving fit data to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_fit_file</span><span class="p">))</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>  <span class="c1"># Change the directory back</span>
                    <span class="k">return</span> <span class="kc">True</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Optimal parameters not found.&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Fit EQE (MLJ Theory)</span>
            <span class="k">elif</span> <span class="n">file_no</span> <span class="o">==</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">S_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Huang_Rhys</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">vib_Energy</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extra_Temperature</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

                <span class="n">guessStart_CT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStart</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">guessStop_CT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">guessStart_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStart_sig</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">guessStop_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStop_sig</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extra_static_Disorder</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Attempt peak fit:</span>
                <span class="n">x_MLJ_theory</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">startPlotFit</span><span class="p">,</span> <span class="n">stopPlotFit</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

                <span class="n">ECT_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">guessStart_CT</span><span class="p">,</span> <span class="n">guessStop_CT</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="c1"># Sig_guess = np.round(np.arange(guessStart_sig, guessStop_sig + 0.1, 0.2), 3).tolist()</span>
                <span class="n">Sig_guess</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">guessStart_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">guessStop_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

                <span class="c1"># Initialize parameters</span>
                <span class="n">r_squared</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># bounds = None  # First try without bounds and initial guesses</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds_sig</span>  <span class="c1"># NOTE: Tried without bounds and it didn&#39;t work</span>

                <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                    <span class="c1"># NOTE: This code could be replaced by the guess fit function</span>
                    <span class="k">for</span> <span class="n">ECT</span> <span class="ow">in</span> <span class="n">ECT_guess</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">Sig_guess</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">fit_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_disorder</span><span class="p">,</span>
                                                                                  <span class="n">energy_fit</span><span class="p">,</span>
                                                                                  <span class="n">eqe_fit</span><span class="p">,</span>
                                                                                  <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                                                                                  <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                                                                  <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_Disorder</span>
                                                                                  <span class="p">)</span>

                                <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">y_MLJ_theory</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_disorder</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                               <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                               <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                               <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                                               <span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                                                               <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_MLJ_theory</span><span class="p">]</span>
                                    <span class="n">fit_ok</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">break</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Wrong fit determined.&#39;</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">ECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
                                <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds_sig</span>
                        <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">break</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe_df</span><span class="p">,</span>
                                                                <span class="n">startE</span><span class="o">=</span><span class="n">startFit</span><span class="p">,</span>
                                                                <span class="n">stopE</span><span class="o">=</span><span class="n">stopFit</span><span class="p">,</span>
                                                                <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian</span><span class="p">,</span>
                                                                <span class="n">guessRange</span><span class="o">=</span><span class="n">ECT_guess</span><span class="p">,</span>
                                                                <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">Sig_guess</span><span class="p">,</span>
                                                                <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function instead of fit model</span>
                                                                <span class="p">)</span>

                    <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">y_MLJ_theory</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                          <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                          <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                          <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_MLJ_theory</span><span class="p">]</span>
                        <span class="n">fit_ok</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Save fit data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_extraFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">fit_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                    <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_MLJ_theory</span>
                    <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_MLJ_theory</span>
                    <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span>
                    <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;CT State Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="n">fit_file</span><span class="p">[</span><span class="s1">&#39;Sigma (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                    <span class="n">save_fit_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># User to pick folder &amp; name to save to</span>
                    <span class="n">save_fit_path</span><span class="p">,</span> <span class="n">save_fit_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">save_fit_file</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">save_fit_path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check if the user actually selected a path</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">save_fit_path</span><span class="p">)</span>  <span class="c1"># Change the working directory</span>
                        <span class="n">fit_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_fit_filename</span><span class="p">)</span>  <span class="c1"># Save data to csv</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving fit data to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_fit_file</span><span class="p">))</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>  <span class="c1"># Change the directory back</span>

                <span class="k">if</span> <span class="n">fit_ok</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initial Guess (eV) : &#39;</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature [T] (K) : &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Oscillator Strength [f] (eV**2) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reorganization Energy [l] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CT State Energy [ECT] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sigma (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                        <span class="n">W</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gaussian Variance [W] (eV K) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">))</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2 : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">r_squared</span><span class="p">,</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="c1"># Plot EQE data and CT fit</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span>
                                      <span class="n">eqe</span><span class="p">,</span>
                                      <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                      <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="n">color_</span>
                                      <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">y_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit + Disorder&#39;</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                          <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">y_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit&#39;</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                          <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span>
                                          <span class="n">eqe</span><span class="p">,</span>
                                          <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="n">color_</span>
                                          <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">y_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit + Disorder&#39;</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                          <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">y_MLJ_theory</span><span class="p">,</span>
                                          <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit&#39;</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                          <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">True</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Optimal parameters not found.&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to generate heat map of fitting values</span>

<div class="viewcode-block" id="MainWindow.heatMap"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.heatMap">[docs]</a>    <span class="k">def</span> <span class="nf">heatMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">eqe_df</span><span class="p">,</span>
                <span class="n">startStartE</span><span class="p">,</span>
                <span class="n">startStopE</span><span class="p">,</span>
                <span class="n">stopStartE</span><span class="p">,</span>
                <span class="n">stopStopE</span><span class="p">,</span>
                <span class="n">filename_Box</span><span class="p">,</span>
                <span class="n">label_Box</span><span class="p">,</span>
                <span class="n">color_Box</span><span class="p">,</span>
                <span class="n">file_no</span>
                <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to generate heatmap for fit values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eqe_df : DataFrame, required</span>
<span class="sd">            Dataframe with EQE data</span>
<span class="sd">        startStartE : float, required</span>
<span class="sd">            Start of the start fit energy range</span>
<span class="sd">        startStopE : float, required</span>
<span class="sd">            Start of the stop fit energy range</span>
<span class="sd">        stopStartE : float, required</span>
<span class="sd">            Stop of the start fit energy range</span>
<span class="sd">        stopStopE : float, required</span>
<span class="sd">            Stop of the stop fit energy range</span>
<span class="sd">        filename_Box : gui object, required</span>
<span class="sd">            GUI text box with filename to use for plot labeling</span>
<span class="sd">        label_Box : gui object, required</span>
<span class="sd">            GUI text box with plot label</span>
<span class="sd">        color_Box : gui object, required</span>
<span class="sd">            GUI text box with plot color</span>
<span class="sd">        file_no : int, required</span>
<span class="sd">            Number of EQE file to plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>            

        <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">fit_opticalPeak</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">startStartE</span> <span class="o">=</span> <span class="n">startStartE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">startStopE</span> <span class="o">=</span> <span class="n">startStopE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stopStartE</span> <span class="o">=</span> <span class="n">stopStartE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stopStopE</span> <span class="o">=</span> <span class="n">stopStopE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">startStart_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startStartE</span><span class="p">,</span> <span class="n">startStopE</span><span class="p">)</span>  <span class="c1"># Check that start energy is lower than stop energy</span>
        <span class="c1"># startStop_ok = StartStop_is_valid(startStopE, stopStartE)</span>
        <span class="n">stopStop_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">stopStartE</span><span class="p">,</span> <span class="n">stopStopE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">startStart_ok</span> <span class="ow">and</span> <span class="n">stopStop_ok</span><span class="p">:</span>  <span class="c1"># If all operations are valid, proceed with heat map calculations</span>

            <span class="n">startEnergies</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Create empty lists for start and stop energies</span>
            <span class="n">stopEnergies</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">start_df</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Create empty lists for fit data collection</span>
            <span class="n">stop_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">f_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">l_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Ect_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">R_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sig_df</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">startStartE</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stopStartE</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="nb">float</span><span class="p">(</span><span class="n">startStopE</span><span class="p">):</span>  <span class="c1"># As long as start range start value is smaller than start range stop value</span>
                <span class="n">startEnergies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># Round to three digits</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mf">0.005</span>  <span class="c1"># NOTE: Adjust this number to change resolution</span>

            <span class="k">while</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stopStopE</span><span class="p">):</span>
                <span class="n">stopEnergies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mf">0.005</span>

            <span class="c1"># Fit EQE (Marcus Theory)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_no</span><span class="p">))</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">file_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Range 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Temperature_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStart_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStop_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStartSig_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStopSig_1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>  <span class="c1"># Check peak to fit</span>
                        <span class="n">fit_opticalPeak</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_1</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">file_no</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Range 2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Temperature_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStart_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStop_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStart_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStartSig_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="n">guessStop_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStopSig_2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">fit_opticalPeak</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">OptButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">CTButton_2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid peak to fit.&#39;</span><span class="p">)</span>

                <span class="c1"># Attempt peak fit:</span>
                <span class="n">ECT_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">guessStart</span><span class="p">,</span> <span class="n">guessStop</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Increased step</span>
                <span class="c1"># Sig_guess = np.round(np.arange(guessStart_sig, guessStop_sig + 0.05, 0.05), 3).tolist()</span>
                <span class="n">Sig_guess</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">guessStart_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">guessStop_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">startEnergies</span><span class="p">):</span>  <span class="c1"># Iterate through start energies</span>
                    <span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">stopEnergies</span><span class="p">):</span>  <span class="c1"># Iterate through stop energies</span>
                        <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe_df</span><span class="p">,</span>
                                                                        <span class="n">startE</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                                                                        <span class="n">stopE</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
                                                                        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder</span><span class="p">,</span>
                                                                        <span class="n">guessRange</span><span class="o">=</span><span class="n">ECT_guess</span><span class="p">,</span>
                                                                        <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">Sig_guess</span><span class="p">,</span>
                                                                        <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                        <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># to use fit model</span>
                                                                        <span class="p">)</span>

                            <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">start_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                                <span class="n">stop_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
                                <span class="n">f_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">l_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">Ect_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                                <span class="n">sig_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                                <span class="n">R_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Optimal parameters not found.&#39;</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe_df</span><span class="p">,</span>
                                                                        <span class="n">startE</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                                                                        <span class="n">stopE</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
                                                                        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian</span><span class="p">,</span>
                                                                        <span class="n">guessRange</span><span class="o">=</span><span class="n">ECT_guess</span><span class="p">,</span>
                                                                        <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">Sig_guess</span><span class="p">,</span>
                                                                        <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                        <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># to use fit function</span>
                                                                        <span class="p">)</span>

                            <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">start_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                                <span class="n">stop_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
                                <span class="n">f_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">l_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">Ect_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                                <span class="n">R_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Optimal parameters not found.&#39;</span><span class="p">)</span>

            <span class="c1"># Fit EQE (MLJ Theory)</span>
            <span class="k">elif</span> <span class="n">file_no</span> <span class="o">==</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">S_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Huang_Rhys</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">vib_Energy</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extra_Temperature</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

                <span class="n">guessStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStart</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">guessStop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">guessStart_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStart_sig</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">guessStop_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStop_sig</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extra_static_Disorder</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Attempt peak fit:</span>
                <span class="n">ECT_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">guessStart</span><span class="p">,</span> <span class="n">guessStop</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Increased step</span>
                <span class="c1"># Sig_guess = np.round(np.arange(guessStart_sig, guessStop_sig + 0.05, 0.05), 3).tolist()</span>
                <span class="n">Sig_guess</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">guessStart_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">guessStop_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">startEnergies</span><span class="p">):</span>  <span class="c1"># Iterate through start energies</span>
                    <span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">stopEnergies</span><span class="p">):</span>  <span class="c1"># Iterate through stop energies</span>

                        <span class="n">wave_fit</span><span class="p">,</span> <span class="n">energy_fit</span><span class="p">,</span> <span class="n">eqe_fit</span><span class="p">,</span> <span class="n">log_eqe_fit</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">eqe_df</span><span class="p">,</span>
                                                                                 <span class="n">start</span><span class="p">,</span>
                                                                                 <span class="n">stop</span><span class="p">,</span>
                                                                                 <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                            <span class="c1"># NOTE: This code could be replaced by the guess fit function</span>
                            <span class="k">for</span> <span class="n">ECT</span> <span class="ow">in</span> <span class="n">ECT_guess</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">Sig_guess</span><span class="p">:</span>
                                    <span class="n">r_squared</span> <span class="o">=</span> <span class="mi">0</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">fit_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_disorder</span><span class="p">,</span>
                                                                                          <span class="n">energy_fit</span><span class="p">,</span>
                                                                                          <span class="n">eqe_fit</span><span class="p">,</span>
                                                                                          <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                                                                                          <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                                                                          <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_Disorder</span>
                                                                                          <span class="p">)</span>
                                    <span class="k">except</span><span class="p">:</span>
                                        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">ECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
                                        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds_sig</span>
                                        <span class="k">if</span> <span class="n">ECT</span> <span class="o">==</span> <span class="n">ECT_guess</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Optimal parameters not found.&#39;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">start_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                                        <span class="n">stop_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
                                        <span class="n">f_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                        <span class="n">l_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                        <span class="n">Ect_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                                        <span class="n">sig_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                                        <span class="n">R_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>
                                        <span class="k">break</span>
                                <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># To break the second loop</span>
                                    <span class="k">break</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe_df</span><span class="p">,</span>
                                                                        <span class="n">startE</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                                                                        <span class="n">stopE</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
                                                                        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian</span><span class="p">,</span>
                                                                        <span class="n">guessRange</span><span class="o">=</span><span class="n">ECT_guess</span><span class="p">,</span>
                                                                        <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">Sig_guess</span><span class="p">,</span>
                                                                        <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                        <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function</span>
                                                                        <span class="p">)</span>

                            <span class="k">if</span> <span class="n">r_squared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">start_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                                <span class="n">stop_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
                                <span class="n">f_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">l_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">Ect_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                                <span class="n">R_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Optimal parameters not found.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">R_df</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check that there are results to plot</span>

                <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                    <span class="n">parameter_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                        <span class="p">{</span><span class="s1">&#39;Start&#39;</span><span class="p">:</span> <span class="n">start_df</span><span class="p">,</span>
                         <span class="s1">&#39;Stop&#39;</span><span class="p">:</span> <span class="n">stop_df</span><span class="p">,</span>
                         <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">f_df</span><span class="p">,</span>
                         <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="n">l_df</span><span class="p">,</span>
                         <span class="s1">&#39;Ect&#39;</span><span class="p">:</span> <span class="n">Ect_df</span><span class="p">,</span>
                         <span class="s1">&#39;R_Squared&#39;</span><span class="p">:</span> <span class="n">R_df</span><span class="p">,</span>
                         <span class="s1">&#39;Sig&#39;</span><span class="p">:</span> <span class="n">sig_df</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameter_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                        <span class="p">{</span><span class="s1">&#39;Start&#39;</span><span class="p">:</span> <span class="n">start_df</span><span class="p">,</span>
                         <span class="s1">&#39;Stop&#39;</span><span class="p">:</span> <span class="n">stop_df</span><span class="p">,</span>
                         <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">f_df</span><span class="p">,</span>
                         <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="n">l_df</span><span class="p">,</span>
                         <span class="s1">&#39;Ect&#39;</span><span class="p">:</span> <span class="n">Ect_df</span><span class="p">,</span>
                         <span class="s1">&#39;R_Squared&#39;</span><span class="p">:</span> <span class="n">R_df</span><span class="p">})</span>

                <span class="n">max_index</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="p">[</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file_no</span> <span class="o">==</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature [T] (K) : &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature [T] (K) : &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Oscillator Strength [f] (eV**2) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                      <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>  <span class="c1"># Determine the average value and standard deviation</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Reorganization Energy [l] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                      <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">fit_opticalPeak</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Optical Peak Energy [E_Opt] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average CT State Energy [ECT] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Sigma [Sig] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">file_no</span> <span class="o">==</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span>
                        <span class="n">Average_W</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                                    <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Average_W</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">+</span> <span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Gaussian Variance [W] (eV K) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">Average_W</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">))</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average R2 : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                      <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max R_squared : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start Energies (eV) : &#39;</span><span class="p">,</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stop Energies (eV) : &#39;</span><span class="p">,</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Oscillator Strength [f] (eV**2) : &#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Reorganization Energy [l] (eV) : &#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">fit_opticalPeak</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Optical Peak Energy [E_Opt] (eV) : &#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average CT State Energy [ECT] (eV) : &#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Ect&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Sigma [Sig] (eV) : &#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                              <span class="nb">format</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">file_no</span> <span class="o">==</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span>
                            <span class="n">Average_W</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">+</span> <span class="p">(</span>
                                    <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">Average_W</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">+</span> <span class="p">(</span>
                                    <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Sig&#39;</span><span class="p">][</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average Gaussian Variance [W] (eV K) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">Average_W</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max R_squared : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;R_Squared&#39;</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start Energy (eV) : &#39;</span><span class="p">,</span> <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">max_index</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stop Energy (eV) : &#39;</span><span class="p">,</span> <span class="n">parameter_df</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">max_index</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># Pivot dataFrame: x-value = Stop, y-value = Start, value = f</span>
                <span class="n">f_df</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
                <span class="n">l_df</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">)</span>
                <span class="n">Ect_df</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="s1">&#39;Ect&#39;</span><span class="p">)</span>
                <span class="n">R_df</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="s1">&#39;R_Squared&#39;</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>  <span class="c1"># Create a new figure</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_1</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">f_df</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Create the heat map</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Initial Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Final Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Oscillator Strength ($eV^2$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_1</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="c1"># plt.tick_params(labelsize=15, direction=&#39;in&#39;, axis=&#39;both&#39;, which=&#39;minor&#39;, length=4, width=2)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_2</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">l_df</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Initial Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Final Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_2</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_3</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">Ect_df</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Initial Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Final Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fit_opticalPeak</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Optical Peak Energy (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CT State Energy (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_3</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_4</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">R_df</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Initial Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Final Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$\mathregular{R^</span><span class="si">{2}</span><span class="s1">}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_4</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                    <span class="n">Sig_df</span> <span class="o">=</span> <span class="n">parameter_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="s1">&#39;Sig&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_5</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">Sig_df</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Initial Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Final Energy Value (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sigma (eV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
                    <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_5</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
                    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No fits determined.&#39;</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Gaussian function</span>

<div class="viewcode-block" id="MainWindow.gaussian"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>   

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainWindow.gaussian_disorder"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory including disorder</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>
<span class="sd">        sig : float, required</span>
<span class="sd">            Gaussian disorder</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>  

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">((</span><span class="n">Ect</span> <span class="o">-</span> <span class="p">(</span><span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span><span class="p">))</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span><span class="p">))</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_CT</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span></div>


    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># MLJ function</span>

<div class="viewcode-block" id="MainWindow.MLJ_gaussian"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_gaussian">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>  

        <span class="n">EQE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EQE_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> \
                    <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_i</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_i</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                    <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                          <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span><span class="p">))</span>
            <span class="n">EQE</span> <span class="o">+=</span> <span class="n">EQE_n</span>
        <span class="k">return</span> <span class="n">EQE</span></div>

    <span class="c1"># MLJ function including disorder</span>

<div class="viewcode-block" id="MainWindow.MLJ_gaussian_disorder"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_gaussian_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_gaussian_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory including disorder</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>
<span class="sd">        sig : float, required</span>
<span class="sd">            Gaussian disorder    </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">EQE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EQE_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> \
                     <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_i</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_i</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                     <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                           <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_x</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="n">EQE</span> <span class="o">+=</span> <span class="n">EQE_n</span>
        <span class="k">return</span> <span class="n">EQE</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Page 6 - Fit EL and EQE</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to scale and reduce EL and EQE</span>

    <span class="c1"># TODO: Check and update EL components</span>

<div class="viewcode-block" id="MainWindow.pre_plot_EL_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.pre_plot_EL_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">pre_plot_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">data_df</span><span class="p">,</span>
                        <span class="n">startE</span><span class="p">,</span>
                        <span class="n">stopE</span><span class="p">,</span>
                        <span class="n">data_no</span><span class="p">,</span>
                        <span class="n">fit</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper function to plot and fit EQE and EL data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_df : dataFrame, required</span>
<span class="sd">            EQE or EL data</span>
<span class="sd">        startE : float, required</span>
<span class="sd">            Start energy to plot</span>
<span class="sd">        stopE : float, required</span>
<span class="sd">            Stop energy to plot</span>
<span class="sd">        data_no : int, required</span>
<span class="sd">            Number of data file to plot and fit</span>
<span class="sd">        fit : bool, required</span>
<span class="sd">            Boolean value specifying whether to perform fit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_Temperature</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">startE</span> <span class="o">=</span> <span class="n">startE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stopE</span> <span class="o">=</span> <span class="n">stopE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_EL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span> <span class="o">=</span> <span class="n">set_up_EL_plot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_EL</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">data_no</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># EL data</span>

            <span class="n">Energy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">scaleFactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scalePlot</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check that file is non-empty</span>

                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">])):</span>  <span class="c1"># Calculate energy values</span>

                    <span class="n">Energy_val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
                    <span class="n">Energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Energy_val</span><span class="p">)</span>

                <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Energy</span>

                <span class="k">if</span> <span class="n">Data_is_valid</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span> <span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">):</span>

                    <span class="n">EL_wave</span><span class="p">,</span> <span class="n">EL_energy</span><span class="p">,</span> <span class="n">EL_signal</span> <span class="o">=</span> <span class="n">compile_EL</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span> <span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">red_EL</span> <span class="o">=</span> <span class="p">[</span><span class="n">EL_signal</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">EL_energy</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                              <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EL_signal</span><span class="p">))]</span>  <span class="c1"># Divide by energy to reduce (checked in Benduhn thesis)</span>
                    <span class="n">red_EL_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">red_EL</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">/</span> <span class="n">scaleFactor</span>
                                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">red_EL</span><span class="p">))]</span>

                    <span class="k">if</span> <span class="n">data_no</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># EL Data</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">fit</span><span class="p">:</span>
                            <span class="n">label_</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_EL2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_EL1</span><span class="p">)</span>
                            <span class="c1"># color_ = pick_EQE_Color(self.ui.textBox_EL3, 100) # not currently used</span>
                            <span class="n">color_</span> <span class="o">=</span> <span class="s1">&#39;#1f77b4&#39;</span>  <span class="c1"># Blue</span>
                            <span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span><span class="p">,</span>
                                 <span class="n">EL_energy</span><span class="p">,</span>
                                 <span class="n">red_EL_scaled</span><span class="p">,</span>
                                 <span class="n">label_</span><span class="p">,</span>
                                 <span class="n">color_</span>
                                 <span class="p">)</span>

                        <span class="k">elif</span> <span class="n">fit</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fit_EL_EQE</span><span class="p">(</span><span class="n">EL_energy</span><span class="p">,</span>
                                            <span class="n">red_EL_scaled</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFit_EL1</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFit_EL1</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">data_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Abs Data</span>

                        <span class="n">bb_dict</span> <span class="o">=</span> <span class="n">bb_spectrum</span><span class="p">(</span><span class="n">EL_energy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span><span class="p">)</span>

                        <span class="c1"># TODO: Old code to be removed?</span>
                        <span class="c1"># EL_abs = [EL_signal[x] / bb_dict[EL_energy[x]] for x in range(len(EL_energy))]</span>
                        <span class="c1"># red_EL_abs_scaled = [EL_abs[x] / (scaleFactor * EL_energy[x]) for x in range(len(EL_abs))]</span>

                        <span class="n">scaleFactor_calc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scalePlot_calc</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

                        <span class="n">EL_abs_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">EL_signal</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">scaleFactor</span> <span class="o">*</span> <span class="n">bb_dict</span><span class="p">[</span><span class="n">EL_energy</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span>
                                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EL_energy</span><span class="p">))]</span>
                        <span class="n">EL_abs_scaled_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">EL_signal</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">scaleFactor_calc</span> <span class="o">*</span> <span class="n">bb_dict</span><span class="p">[</span><span class="n">EL_energy</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span>
                                              <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EL_energy</span><span class="p">))]</span>  <span class="c1"># test which scale factor is correct</span>

                        <span class="n">red_EL_abs_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">EL_energy</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">EL_signal</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">scaleFactor</span> <span class="o">*</span> <span class="n">bb_dict</span><span class="p">[</span><span class="n">EL_energy</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span>
                                             <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EL_energy</span><span class="p">))]</span>
                        <span class="n">red_EL_abs_scaled_test</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">EL_energy</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">EL_signal</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">scaleFactor_calc</span> <span class="o">*</span> <span class="n">bb_dict</span><span class="p">[</span><span class="n">EL_energy</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EL_energy</span><span class="p">))]</span>  <span class="c1"># test which scale factor is correct</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">fit</span><span class="p">:</span>
                            <span class="c1"># label_ = pick_EQE_Label(self.ui.textBox_EL2, self.ui.textBox_EL1)</span>
                            <span class="c1"># color_ = pick_EQE_Color(self.ui.textBox_EL3, 100) # not currently used</span>
                            <span class="n">label_</span> <span class="o">=</span> <span class="s1">&#39;$\mathregular{Red. EQE_</span><span class="si">{cal}</span><span class="s1">}$&#39;</span>
                            <span class="n">color_</span> <span class="o">=</span> <span class="s1">&#39;#ff7716&#39;</span>  <span class="c1"># Orange</span>

                            <span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span><span class="p">,</span>
                                 <span class="n">EL_energy</span><span class="p">,</span>
                                 <span class="n">red_EL_abs_scaled_test</span><span class="p">,</span>
                                 <span class="n">label_</span><span class="o">=</span><span class="n">label_</span><span class="p">,</span>
                                 <span class="n">color_</span><span class="o">=</span><span class="n">color_</span>
                                 <span class="p">)</span>

                        <span class="k">elif</span> <span class="n">fit</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fit_EL_EQE</span><span class="p">(</span><span class="n">EL_energy</span><span class="p">,</span>
                                            <span class="n">red_EL_abs_scaled_test</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFit_EL2</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFit_EL2</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please select a valid EL file.&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">data_no</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># EQE Data</span>

            <span class="k">if</span> <span class="n">Data_is_valid</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span> <span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">Red_EQE_meas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># For determining the intersect between abs and emission</span>
                <span class="n">EQE_wave</span><span class="p">,</span> <span class="n">EQE_energy</span><span class="p">,</span> <span class="n">EQE</span><span class="p">,</span> <span class="n">EQE_log</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span> <span class="n">startE</span><span class="p">,</span> <span class="n">stopE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">red_EQE</span> <span class="o">=</span> <span class="p">[</span><span class="n">EQE</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">EQE_energy</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                           <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EQE</span><span class="p">))]</span>  <span class="c1"># Multiplication confirmed in Benduhn thesis</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">fit</span><span class="p">:</span>
                    <span class="n">label_</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_EL5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_EL4</span><span class="p">)</span>
                    <span class="c1"># color_ = pick_EQE_Color(self.ui.textBox_EL6, 100)</span>
                    <span class="n">color_</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>  <span class="c1"># Black</span>
                    <span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span><span class="p">,</span>
                         <span class="n">EQE_energy</span><span class="p">,</span>
                         <span class="n">red_EQE</span><span class="p">,</span> <span class="n">label_</span><span class="p">,</span> <span class="n">color_</span>
                         <span class="p">)</span>

                <span class="k">elif</span> <span class="n">fit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit_EL_EQE</span><span class="p">(</span><span class="n">EQE_energy</span><span class="p">,</span>
                                    <span class="n">red_EQE</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFit_EQE</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFit_EQE</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to fit reduced EL and EQE</span>

    <span class="c1"># TODO: Check and update EL components</span>
    <span class="c1"># TODO: Add sigma as a fit parameter</span>
    <span class="c1"># TODO: Add guess fit function</span>
    <span class="c1"># TODO: Implement save fit function</span>

<div class="viewcode-block" id="MainWindow.fit_EL_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.fit_EL_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">fit_EL_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">energy</span><span class="p">,</span>
                   <span class="n">y</span><span class="p">,</span>
                   <span class="n">startE</span><span class="p">,</span>
                   <span class="n">stopE</span><span class="p">,</span>
                   <span class="n">data_no</span>
                   <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to fit EL and EQE data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        energy : list, required</span>
<span class="sd">            List of energy values to fit</span>
<span class="sd">        y : list, required</span>
<span class="sd">            List of data values to fit</span>
<span class="sd">        startE : float, required</span>
<span class="sd">            Start energy to fit</span>
<span class="sd">        stopE : float, required</span>
<span class="sd">            Stop energy to fit</span>
<span class="sd">        data_no : int, required</span>
<span class="sd">            Number of data file to plot and fit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">startFit</span> <span class="o">=</span> <span class="n">startE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stopFit</span> <span class="o">=</span> <span class="n">stopE</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy</span>

        <span class="k">if</span> <span class="n">Data_is_valid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">startFit</span><span class="p">,</span> <span class="n">stopFit</span><span class="p">):</span>

            <span class="n">energy_fit</span><span class="p">,</span> <span class="n">y_fit</span> <span class="o">=</span> <span class="n">compile_Data</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">startFit</span><span class="p">,</span> <span class="n">stopFit</span><span class="p">)</span>

            <span class="n">diff</span> <span class="o">=</span> <span class="n">stopFit</span> <span class="o">-</span> <span class="n">startFit</span>  <span class="c1"># Find difference between start and stop fit energy</span>
            <span class="n">x_gaussian</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">startFit</span><span class="p">,</span> <span class="n">stopFit</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">diff</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># Create x values to plot fit</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">static_Disorder_EL</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">include_Disorder</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_Disorder</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Gaussian_EL_EQE</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>  <span class="c1"># Marcus Theory Fitting</span>

                    <span class="k">if</span> <span class="n">data_no</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># EL Data</span>
                        <span class="c1"># TODO: Add sigma as a fit parameter</span>
                        <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>  <span class="c1"># Include Disorder in Fit</span>
                            <span class="c1"># y_fit_smooth = savgol_filter(y_fit, 51, 3) # NOTE: In case you need to smooth the data</span>
                            <span class="c1"># y_fit_smooth = [x for x in y_fit_smooth]</span>
                            <span class="c1"># log_y_fit = [math.log(x) for x in y_fit]</span>
                            <span class="c1"># plot(self.axEL_1, self.axEL_2, energy_fit, y_fit_smooth, &#39;Smoothed Data&#39;, &#39;#330000&#39;)</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EL_disorder</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span>
                                                         <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>
                                                         <span class="p">)</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EL_disorder</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                    <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                    <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                    <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                                    <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Without disorder</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EL</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span>
                                                         <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>
                                                         <span class="p">)</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EL</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                           <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                           <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                           <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">data_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># EQE / Abs Data</span>
                        <span class="n">x_gaussian</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">startFit</span><span class="p">,</span> <span class="n">stopFit</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">diff</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
                        <span class="c1"># TODO: Add sigma as a fit parameter</span>
                        <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EQE_disorder</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()])</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EQE_disorder</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                     <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                     <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                     <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                                     <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EQE</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span>
                                                         <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>
                                                         <span class="p">)</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_EQE</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                            <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                            <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                            <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                            <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature [T] (K): &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Oscillator Strength [f] (eV**2) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reorganization Energy [l] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CT State Energy [ECT] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian Fit + Disorder&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian Fit + Disorder&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian Fit&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian Fit&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">MLJ_Gaussian_EL_EQE</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>  <span class="c1"># MLJ Theory Fitting</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_Huang_Rhys</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i_EL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_vib_Energy</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

                    <span class="n">x_gaussian</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">1.18</span><span class="p">,</span> <span class="n">stopFit</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">diff</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">data_no</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># EL Data</span>
                        <span class="c1"># TODO: Add sigma as a fit parameter</span>
                        <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EL_disorder</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span>
                                                         <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>
                                                         <span class="p">)</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EL_disorder</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                        <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                        <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                        <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                                        <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EL</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span>
                                                         <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>
                                                         <span class="p">)</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EL</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                               <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                               <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                               <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                               <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">data_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># EQE / Abs Data</span>
                        <span class="n">x_gaussian</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">startFit</span><span class="p">,</span> <span class="n">stopFit</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">diff</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
                        <span class="c1"># TODO: Add sigma as a fit parameter</span>
                        <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EQE_disorder</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span>
                                                         <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>
                                                         <span class="p">)</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EQE_disorder</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                         <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                         <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                         <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                                         <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EQE</span><span class="p">,</span>
                                                         <span class="n">energy_fit</span><span class="p">,</span>
                                                         <span class="n">y_fit</span><span class="p">,</span>
                                                         <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">EL_CT_State</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>
                                                         <span class="p">)</span>
                            <span class="n">y_gaussian</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_gaussian_EQE</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                                                <span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x_gaussian</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature [T] (K): &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Oscillator Strength [f] (eV**2) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reorganization Energy [l] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CT State Energy [ECT] (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span>
                          <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">include_Disorder</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit + Disorder&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit + Disorder&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_gaussian</span><span class="p">,</span>
                                         <span class="n">y_gaussian</span><span class="p">,</span>
                                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MLJ Fit&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
                                         <span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Optimal parameters not found.&#39;</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Gaussian function for reduced EL</span>

<div class="viewcode-block" id="MainWindow.gaussian_EL"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_EL">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_EL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory for reduced EL data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EL : float</span>
<span class="sd">            Reduced EL value</span>
<span class="sd">        &quot;&quot;&quot;</span>   

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">-</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span><span class="p">))</span></div>

    <span class="c1"># Gaussian function for reduced EL including disorder</span>

    <span class="c1"># TODO: Add sigma as a fit parameter</span>

<div class="viewcode-block" id="MainWindow.gaussian_EL_disorder"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_EL_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_EL_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory including disorder for reduced EL data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EL : float</span>
<span class="sd">            Reduced EL value</span>
<span class="sd">        &quot;&quot;&quot;</span>   

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">-</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># MLJ function for reduced EL</span>

<div class="viewcode-block" id="MainWindow.MLJ_gaussian_EL"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_gaussian_EL">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_gaussian_EL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory for reduced EL data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EL : float</span>
<span class="sd">            Reduced EL value</span>
<span class="sd">        &quot;&quot;&quot;</span>   

        <span class="n">EL</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EL_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> \
                   <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                   <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">-</span> <span class="n">E</span> <span class="o">-</span> <span class="n">l</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i_EL</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                         <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span><span class="p">))</span>
            <span class="n">EL</span> <span class="o">+=</span> <span class="n">EL_n</span>
        <span class="k">return</span> <span class="n">EL</span></div>

    <span class="c1"># MLJ function for reduced EL including disorder</span>

    <span class="c1"># TODO: Add sigma as a fit parameter</span>

<div class="viewcode-block" id="MainWindow.MLJ_gaussian_EL_disorder"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_gaussian_EL_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_gaussian_EL_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory including disorder for reduced EL data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EL : float</span>
<span class="sd">            Reduced EL value</span>
<span class="sd">        &quot;&quot;&quot;</span>   

        <span class="n">EL</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EL_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> \
                   <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                   <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">-</span> <span class="n">E</span> <span class="o">-</span> <span class="n">l</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i_EL</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                         <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">EL</span> <span class="o">+=</span> <span class="n">EL_n</span>
        <span class="k">return</span> <span class="n">EL</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Gaussian function for reduced EQE</span>

<div class="viewcode-block" id="MainWindow.gaussian_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory for reduced EQE data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            Reduced EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>   

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span><span class="p">))</span></div>

    <span class="c1"># Gaussian function for reduced EQE including disorder</span>

    <span class="c1"># TODO: Add sigma as a fit parameter</span>

<div class="viewcode-block" id="MainWindow.gaussian_EQE_disorder"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_EQE_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_EQE_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory including disorder for reduced EQE data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            Reduced EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>  

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># MLJ function for reduced EQE</span>

<div class="viewcode-block" id="MainWindow.MLJ_gaussian_EQE"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_gaussian_EQE">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_gaussian_EQE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory for reduced EQE data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            Reduced EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>  

        <span class="n">EQE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EQE_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> \
                    <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                    <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i_EL</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                          <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span><span class="p">))</span>
            <span class="n">EQE</span> <span class="o">+=</span> <span class="n">EQE_n</span>
        <span class="k">return</span> <span class="n">EQE</span></div>

    <span class="c1"># MLJ function for reduced EQE including disorder</span>

    <span class="c1"># TODO: Add sigma as a fit parameter</span>

<div class="viewcode-block" id="MainWindow.MLJ_gaussian_EQE_disorder"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_gaussian_EQE_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_gaussian_EQE_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory including for reduced EQE data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            Reduced EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>  

        <span class="n">EQE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EQE_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> \
                    <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_i_EL</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                    <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_i_EL</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                          <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_EL</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig_EL</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">EQE</span> <span class="o">+=</span> <span class="n">EQE_n</span>
        <span class="k">return</span> <span class="n">EQE</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Page 7 - Subtract and Add Peak Fits</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to subtract peak fit from EQE</span>

<div class="viewcode-block" id="MainWindow.subtract_Fit"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.subtract_Fit">[docs]</a>    <span class="k">def</span> <span class="nf">subtract_Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">data_Fit</span><span class="p">,</span>
                     <span class="n">data_EQE</span><span class="p">,</span>
                     <span class="n">label_Fit</span><span class="p">,</span>
                     <span class="n">label_EQE</span><span class="p">,</span>
                     <span class="n">color_Fit</span><span class="p">,</span>
                     <span class="n">color_EQE</span>
                     <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to subtract fit from EQE data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_Fit : dataFrame, required</span>
<span class="sd">            Fit data to subtract</span>
<span class="sd">        data_EQE: dataFrame, required</span>
<span class="sd">            EQE data to subtract fit from</span>
<span class="sd">        label_Fit: gui object, required</span>
<span class="sd">            GUI text box with fit plot label</span>
<span class="sd">        label_EQE: gui object, required</span>
<span class="sd">            GUI text box with EQE plot label</span>
<span class="sd">        color_Fit: gui object, required</span>
<span class="sd">            GUI text box with fit plot color</span>
<span class="sd">        color_EQE: gui object, required</span>
<span class="sd">            GUI text box with EQE plot color</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">E_fit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sub_EQE</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">label_fit</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="n">label_Fit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_1</span><span class="p">)</span>
        <span class="n">label_eqe</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="n">label_EQE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p6_4</span><span class="p">)</span>

        <span class="n">color_fit</span> <span class="o">=</span> <span class="n">color_Fit</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">color_fit</span> <span class="o">=</span> <span class="n">color_fit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">color_eqe</span> <span class="o">=</span> <span class="n">color_EQE</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">color_eqe</span> <span class="o">=</span> <span class="n">color_eqe</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_fit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_Colour</span><span class="p">(</span><span class="n">color_fit</span><span class="p">):</span>
            <span class="n">color_fit</span> <span class="o">=</span> <span class="s1">&#39;#ff7716&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_eqe</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_Colour</span><span class="p">(</span><span class="n">color_eqe</span><span class="p">):</span>
            <span class="n">color_eqe</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Check if fit for an optical peak was imported</span>
            <span class="n">T_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">f_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">l_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">E_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Optical Peak Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># Check if fit for a CT state was imported</span>
                <span class="n">T_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">f_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">l_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">E_fit</span> <span class="o">=</span> <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;CT State Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please import a valid fit file.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">E_fit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Only progress if a valid energy was imported</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])):</span>
                <span class="n">fit_value</span> <span class="o">=</span> <span class="n">calculate_gaussian_absorption</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                          <span class="n">f_fit</span><span class="p">,</span>
                                                          <span class="n">l_fit</span><span class="p">,</span>
                                                          <span class="n">E_fit</span><span class="p">,</span>
                                                          <span class="n">T_fit</span>
                                                          <span class="p">)</span>
                <span class="n">sub_EQE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">fit_value</span><span class="p">)</span>

            <span class="c1"># Save fit data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_subEQE</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>

                <span class="n">sub_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">sub_file</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_EQE</span>
                <span class="n">sub_file</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span>
                <span class="n">sub_file</span><span class="p">[</span><span class="s1">&#39;Log_EQE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sub_EQE</span><span class="p">)</span>
                <span class="n">sub_file</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>

                <span class="n">save_sub_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># User to pick a folder &amp; name to save data to</span>
                <span class="n">save_sub_path</span><span class="p">,</span> <span class="n">save_sub_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">save_sub_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">save_sub_path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check if the user actually selected a path</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">save_sub_path</span><span class="p">)</span>  <span class="c1"># Change the working directory</span>
                    <span class="n">sub_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_sub_filename</span><span class="p">)</span>  <span class="c1"># Save data to csv</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving fit data to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_sub_file</span><span class="p">))</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>  <span class="c1"># Change the directory back</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axSub_2</span> <span class="o">=</span> <span class="n">set_up_EQE_plot</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                              <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">],</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">color_fit</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="n">label_fit</span>
                              <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                              <span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">],</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">color_eqe</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="n">label_eqe</span>
                              <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                              <span class="n">sub_EQE</span><span class="p">,</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#1f77b4&#39;</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Subtracted EQE&#39;</span>
                              <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                              <span class="n">data_Fit</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">],</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">color_fit</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="n">label_fit</span>
                              <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                              <span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">],</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">color_eqe</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="n">label_eqe</span>
                              <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                              <span class="n">sub_EQE</span><span class="p">,</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#1f77b4&#39;</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Subtracted EQE&#39;</span>
                              <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axSub_2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to add peak fits</span>

    <span class="c1"># TODO: Expand to plot MLJ fits</span>

<div class="viewcode-block" id="MainWindow.add_Fits"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.add_Fits">[docs]</a>    <span class="k">def</span> <span class="nf">add_Fits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">data_OptFit</span><span class="p">,</span>
                 <span class="n">data_CTFit</span><span class="p">,</span>
                 <span class="n">data_EQE</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to add peak fits</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_OptFit: dataFrame, required</span>
<span class="sd">            Optical peak fit data</span>
<span class="sd">        data_CTFit: dataFrame, required</span>
<span class="sd">            CT state fit data</span>
<span class="sd">        data_EQE: dataFrame, required</span>
<span class="sd">            EQE data</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">add_Energy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">add_Fits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">label_OptFit</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_1</span><span class="p">)</span>
        <span class="n">label_CTFit</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_4</span><span class="p">)</span>
        <span class="n">label_EQE</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_7</span><span class="p">)</span>

        <span class="n">color_OptFit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_3</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">color_OptFit</span> <span class="o">=</span> <span class="n">color_OptFit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">color_CTFit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_6</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">color_CTFit</span> <span class="o">=</span> <span class="n">color_CTFit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">color_EQE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_9</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">color_EQE</span> <span class="o">=</span> <span class="n">color_EQE</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_OptFit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_Colour</span><span class="p">(</span><span class="n">color_OptFit</span><span class="p">):</span>
            <span class="n">color_OptFit</span> <span class="o">=</span> <span class="s1">&#39;#ff7716&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_CTFit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_Colour</span><span class="p">(</span><span class="n">color_CTFit</span><span class="p">):</span>
            <span class="n">color_CTFit</span> <span class="o">=</span> <span class="s1">&#39;#1f77b4&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_EQE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_Colour</span><span class="p">(</span><span class="n">color_EQE</span><span class="p">):</span>
            <span class="n">color_EQE</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Check if fit for an optical peak was imported</span>
            <span class="n">T_OptFit</span> <span class="o">=</span> <span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">f_OptFit</span> <span class="o">=</span> <span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">l_OptFit</span> <span class="o">=</span> <span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">E_OptFit</span> <span class="o">=</span> <span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Optical Peak Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No optical peak fit imported.&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Check if fit for a CT state fit was importated</span>
            <span class="n">T_CTFit</span> <span class="o">=</span> <span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">f_CTFit</span> <span class="o">=</span> <span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">l_CTFit</span> <span class="o">=</span> <span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">E_CTFit</span> <span class="o">=</span> <span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;CT State Energy (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sig_CTFit</span> <span class="o">=</span> <span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Sigma (eV)&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No CT state fit imported.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">E_OptFit</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">E_CTFit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Only progress if a valid energy was imported</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]):</span>
                        <span class="n">OptFit_value</span> <span class="o">=</span> <span class="n">calculate_gaussian_absorption</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                     <span class="n">f_OptFit</span><span class="p">,</span>
                                                                     <span class="n">l_OptFit</span><span class="p">,</span>
                                                                     <span class="n">E_OptFit</span><span class="p">,</span>
                                                                     <span class="n">T_OptFit</span>
                                                                     <span class="p">)</span>
                        <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                            <span class="n">CTFit_value</span> <span class="o">=</span> <span class="n">calculate_gaussian_disorder_absorption</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                                 <span class="n">f_CTFit</span><span class="p">,</span>
                                                                                 <span class="n">l_CTFit</span><span class="p">,</span>
                                                                                 <span class="n">E_CTFit</span><span class="p">,</span>
                                                                                 <span class="n">sig_CTFit</span><span class="p">,</span>
                                                                                 <span class="n">T_CTFit</span>
                                                                                 <span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">CTFit_value</span> <span class="o">=</span> <span class="n">calculate_gaussian_absorption</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                        <span class="n">f_CTFit</span><span class="p">,</span>
                                                                        <span class="n">l_CTFit</span><span class="p">,</span>
                                                                        <span class="n">E_CTFit</span><span class="p">,</span>
                                                                        <span class="n">T_CTFit</span>
                                                                        <span class="p">)</span>
                        <span class="n">add_Energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">add_Fits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OptFit_value</span> <span class="o">+</span> <span class="n">CTFit_value</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_2</span> <span class="o">=</span> <span class="n">set_up_EQE_plot</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                                  <span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">],</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">color_OptFit</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="n">label_OptFit</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                                  <span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">],</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">color_CTFit</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="n">label_CTFit</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_Energy</span><span class="p">,</span>
                                  <span class="n">add_Fits</span><span class="p">,</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathrm</span><span class="si">{S_1}</span><span class="s1">$ + CT Fit&#39;</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                                  <span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">],</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">color_EQE</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="n">label_EQE</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                                  <span class="n">data_OptFit</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">],</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">color_OptFit</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="n">label_OptFit</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                                  <span class="n">data_CTFit</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">],</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">color_CTFit</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="n">label_CTFit</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_Energy</span><span class="p">,</span>
                                  <span class="n">add_Fits</span><span class="p">,</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathrm</span><span class="si">{S_1}</span><span class="s1">$ + CT Fit&#39;</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                                  <span class="n">data_EQE</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">],</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="n">color_EQE</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="n">label_EQE</span>
                                  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axAdd_2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

                <span class="n">df_add</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">df_add</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">add_Energy</span><span class="p">)</span>
                <span class="n">df_add</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">add_Fits</span><span class="p">)</span>

                <span class="n">EQE_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_p7_7</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
                <span class="n">df_add</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">EQE_label</span><span class="si">}</span><span class="s1">_Fit_sum.csv&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please import a valid EQE file.&#39;</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Page 4 - Extended Fits (Marcus Theory)</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Separate Double Peak Fit</span>

    <span class="c1"># Function to compile fits for separate double peak fitting</span>

<div class="viewcode-block" id="MainWindow.double_fit"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.double_fit">[docs]</a>    <span class="k">def</span> <span class="nf">double_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to perform separate double fit of S1 and CT peaks</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">increase_factor</span> <span class="o">=</span> <span class="mf">1.05</span>  <span class="c1"># NOTE: Modify to increase data range for R2 calculation and fit selection</span>
        <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">guessRange_Sig</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Import relevant parameters</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bias_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tolerance</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Constraining fit below EQE data.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Not constraining fit.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">startGuess_Sig</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStartSig_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="n">stopGuess_Sig</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStopSig_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="n">guessSig_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startGuess_Sig</span><span class="p">,</span> <span class="n">stopGuess_Sig</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">guessSig_ok</span><span class="p">:</span>
                <span class="c1"># guessRange_Sig = np.round(np.arange(startGuess_Sig, stopGuess_Sig + 0.05, 0.05), 3).tolist()</span>
                <span class="n">guessRange_Sig</span> <span class="o">=</span> <span class="p">[</span><span class="n">startGuess_Sig</span><span class="p">,</span> <span class="n">stopGuess_Sig</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># guessRange_Sig = np.round(np.arange(startGuess_Sig, startGuess_Sig + 0.05, 0.05), 3).tolist()</span>
                <span class="n">guessRange_Sig</span> <span class="o">=</span> <span class="p">[</span><span class="n">startGuess_Sig</span><span class="p">,</span> <span class="n">stopGuess_Sig</span><span class="p">]</span>

        <span class="n">eqe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_double</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_double</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">double_Temperature</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">startStart_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStart_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">startStop_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStop_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStart_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStart_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStop_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStop_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

        <span class="n">startStart_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStart_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">startStop_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStop_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStart_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStart_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStop_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStop_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

        <span class="n">startGuess_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStart_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopGuess_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStop_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">startGuess_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStart_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopGuess_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">guessStop_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

        <span class="c1"># Check that all start and stop energies are valid</span>

        <span class="c1"># startOpt_ok = StartStop_is_valid(startStart_Opt, startStop_Opt)</span>
        <span class="c1"># stopOpt_ok = StartStop_is_valid(stopStart_Opt, stopStop_Opt)</span>

        <span class="n">startOpt_ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">stopOpt_ok</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># startCT_ok = StartStop_is_valid(startStart_CT, startStop_CT)</span>
        <span class="c1"># stopCT_ok = StartStop_is_valid(stopStart_CT, stopStop_CT)</span>

        <span class="n">startCT_ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">stopCT_ok</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">guessOpt_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startGuess_Opt</span><span class="p">,</span> <span class="n">stopGuess_Opt</span><span class="p">)</span>
        <span class="n">guessCT_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startGuess_CT</span><span class="p">,</span> <span class="n">stopGuess_CT</span><span class="p">)</span>

        <span class="c1"># Compile all start / stop energies for Opt and CT fit</span>

        <span class="k">if</span> <span class="n">startOpt_ok</span> <span class="ow">and</span> <span class="n">stopOpt_ok</span> <span class="ow">and</span> <span class="n">guessOpt_ok</span> <span class="ow">and</span> <span class="n">startCT_ok</span> <span class="ow">and</span> <span class="n">stopCT_ok</span> <span class="ow">and</span> <span class="n">guessCT_ok</span><span class="p">:</span>

            <span class="n">startRange_Opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startStart_Opt</span><span class="p">,</span> <span class="n">startStop_Opt</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># Change step to 0.05</span>
            <span class="n">stopRange_Opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stopStart_Opt</span><span class="p">,</span> <span class="n">stopStop_Opt</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">startRange_CT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startStart_CT</span><span class="p">,</span> <span class="n">startStop_CT</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">stopRange_CT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stopStart_CT</span><span class="p">,</span> <span class="n">stopStop_CT</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">guessRange_Opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startGuess_Opt</span><span class="p">,</span> <span class="n">stopGuess_Opt</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">guessRange_CT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startGuess_CT</span><span class="p">,</span> <span class="n">stopGuess_CT</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="c1"># Compile a dataFrame with all combinations of start / stop values for Opt and CT fit</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Compiling Fit Ranges ...&#39;</span><span class="p">)</span>

            <span class="n">df_Opt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">df_CT</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="n">start_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start_CT_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_CT_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">startOpt</span> <span class="ow">in</span> <span class="n">startRange_Opt</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stopOpt</span> <span class="ow">in</span> <span class="n">stopRange_Opt</span><span class="p">:</span>
                    <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">startOpt</span><span class="p">)</span>
                    <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stopOpt</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">startCT</span> <span class="ow">in</span> <span class="n">startRange_CT</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stopCT</span> <span class="ow">in</span> <span class="n">stopRange_CT</span><span class="p">:</span>
                    <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">startCT</span><span class="p">)</span>
                    <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stopCT</span><span class="p">)</span>

            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_Opt_list</span>
            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_Opt_list</span>

            <span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_CT_list</span>
            <span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_CT_list</span>

            <span class="c1"># Calculate all optical peak fits</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating Optical Peak Fits ...&#39;</span><span class="p">)</span>

            <span class="n">cal_vals_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_guess_fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                                                  <span class="n">df</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">,</span>
                                                                  <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                  <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double</span><span class="p">,</span>
                                                                  <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_Opt</span>
                                                                  <span class="p">),</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">)))))</span>

            <span class="n">best_vals_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">list_</span><span class="p">:</span> <span class="n">sep_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cal_vals_Opt</span><span class="p">))</span>
            <span class="n">covar_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">list_</span><span class="p">:</span> <span class="n">sep_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cal_vals_Opt</span><span class="p">))</span>
            <span class="n">R2_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">list_</span><span class="p">:</span> <span class="n">sep_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">cal_vals_Opt</span><span class="p">))</span>

            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_Opt</span>
            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">covar_Opt</span>
            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_Opt</span>

            <span class="c1"># Calculate CT state fits</span>

            <span class="n">start_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start_CT_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_CT_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">best_vals_Opt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">best_vals_CT</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">Opt_covar_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">CT_covar_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">R2_Opt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">R2_CT</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">combined_R2_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">Opt_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">CT_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">combined_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Energy_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">EQE_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating CT State Fits ...&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Including CT State Disorder ...&#39;</span><span class="p">)</span>

            <span class="c1"># If Optical peak to be subtracted before CT fit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">subtract_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bestSubtract_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Subtracting All Optical Peak Fits ...&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">))):</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_CT</span><span class="p">))):</span>
                        <span class="k">if</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check that the optical peak fit was successful</span>

                            <span class="n">new_eqe</span> <span class="o">=</span> <span class="n">subtract_Opt</span><span class="p">(</span><span class="n">eqe</span><span class="p">,</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                                <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                            <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder_double</span><span class="p">,</span>
                                                                            <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                            <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">guessRange_Sig</span><span class="p">,</span>
                                                                            <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                            <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># to use fit model</span>
                                                                            <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                            <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double</span><span class="p">,</span>
                                                                            <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                            <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                            <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function</span>
                                                                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                            <span class="n">r_squared</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="n">Opt_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">CT_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>
                        <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                        <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                        <span class="n">best_vals_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">best_vals_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">)</span>
                        <span class="n">R2_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">R2_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>

                        <span class="c1"># Calculate combined fit here</span>
                        <span class="n">parameter_dict</span> <span class="o">=</span> <span class="n">calculate_combined_fit</span><span class="p">(</span><span class="n">stopE</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">best_vals_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">best_vals_CT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">,</span>
                                                                <span class="n">R2_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">R2_CT</span><span class="o">=</span><span class="n">r_squared</span><span class="p">,</span>
                                                                <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">,</span>
                                                                <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
                                                                <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
                                                                <span class="nb">range</span><span class="o">=</span><span class="n">increase_factor</span><span class="p">,</span>
                                                                <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span>
                                                                <span class="p">)</span>

                        <span class="n">combined_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Combined&#39;</span><span class="p">])</span>
                        <span class="n">combined_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Combined_Fit&#39;</span><span class="p">])</span>
                        <span class="n">Opt_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">])</span>
                        <span class="n">CT_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">])</span>
                        <span class="n">Energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                        <span class="n">EQE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span>

            <span class="c1"># If only best Optical peak is to be subtracted before CT fit</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bestSubtract_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">subtract_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Subtracting Only Best Optical Peak Fit ...&#39;</span><span class="p">)</span>

                <span class="c1"># best_fit_index = df_Opt[&#39;Fit&#39;][df_Opt[&#39;R2&#39;]==max(df_Opt[&#39;R2&#39;])].index[0]</span>
                <span class="c1"># print(best_fit_index)</span>

                <span class="c1"># To avoid picking a fit that has a high R2 but moves above the data</span>
                <span class="n">advanced_R2_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">)):</span>
                    <span class="n">wave_fit</span><span class="p">,</span> <span class="n">energy_fit</span><span class="p">,</span> <span class="n">eqe_fit</span><span class="p">,</span> <span class="n">log_eqe_fit</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">eqe</span><span class="p">,</span>
                                                                             <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                             <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">increase_factor</span><span class="p">,</span>
                                                                             <span class="mi">1</span><span class="p">)</span>
                    <span class="n">y_fit</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double</span><span class="p">(</span><span class="n">e</span><span class="p">,</span>
                                                  <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                  <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                                                  <span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">energy_fit</span><span class="p">]</span>
                    <span class="n">advanced_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_squared</span><span class="p">(</span><span class="n">eqe_fit</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">))</span>

                <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Advanced R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">advanced_R2_list</span>

                <span class="n">best_fit_index</span> <span class="o">=</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Advanced R2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Advanced R2&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># print(best_fit_index)</span>

                <span class="n">new_eqe</span> <span class="o">=</span> <span class="n">subtract_Opt</span><span class="p">(</span><span class="n">eqe</span><span class="p">,</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">],</span> <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_CT</span><span class="p">))):</span>

                    <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                        <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                    <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder_double</span><span class="p">,</span>
                                                                    <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                    <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">guessRange_Sig</span><span class="p">,</span>
                                                                    <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                    <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># to use fit model</span>
                                                                    <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                    <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double</span><span class="p">,</span>
                                                                    <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                    <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                    <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function</span>
                                                                    <span class="p">)</span>

                    <span class="n">Opt_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">CT_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>
                    <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">best_vals_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">best_vals_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">)</span>
                    <span class="n">R2_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">R2_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>

                    <span class="c1"># Calculate combined fit here</span>
                    <span class="n">parameter_dict</span> <span class="o">=</span> <span class="n">calculate_combined_fit</span><span class="p">(</span><span class="n">stopE</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                            <span class="n">best_vals_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                            <span class="n">best_vals_CT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">,</span>
                                                            <span class="n">R2_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                            <span class="n">R2_CT</span><span class="o">=</span><span class="n">r_squared</span><span class="p">,</span>
                                                            <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                            <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">,</span>
                                                            <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
                                                            <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
                                                            <span class="nb">range</span><span class="o">=</span><span class="n">increase_factor</span><span class="p">,</span>
                                                            <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span>
                                                            <span class="p">)</span>

                    <span class="n">combined_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Combined&#39;</span><span class="p">])</span>
                    <span class="n">combined_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Combined_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Opt_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">])</span>
                    <span class="n">CT_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                    <span class="n">EQE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span>

            <span class="c1"># If Optical peak not to be subtracted before CT fit</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">subtract_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bestSubtract_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Not Subtracting Optical Peak Fits.&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">))):</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_CT</span><span class="p">))):</span>

                        <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                        <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder_double</span><span class="p">,</span>
                                                                        <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                        <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">guessRange_Sig</span><span class="p">,</span>
                                                                        <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                        <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># to use fit model</span>
                                                                        <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                        <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double</span><span class="p">,</span>
                                                                        <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                        <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                        <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function</span>
                                                                        <span class="p">)</span>
                    <span class="n">Opt_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">CT_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>
                    <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">best_vals_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">best_vals_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">)</span>
                    <span class="n">R2_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">R2_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>

                    <span class="c1"># Calculate combined fit here</span>
                    <span class="n">parameter_dict</span> <span class="o">=</span> <span class="n">calculate_combined_fit</span><span class="p">(</span><span class="n">stopE</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                            <span class="n">best_vals_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                            <span class="n">best_vals_CT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">,</span>
                                                            <span class="n">R2_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                            <span class="n">R2_CT</span><span class="o">=</span><span class="n">r_squared</span><span class="p">,</span>
                                                            <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                            <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">,</span>
                                                            <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
                                                            <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
                                                            <span class="nb">range</span><span class="o">=</span><span class="n">increase_factor</span><span class="p">,</span>
                                                            <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span>
                                                            <span class="p">)</span>

                    <span class="n">combined_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Combined&#39;</span><span class="p">])</span>
                    <span class="n">combined_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Combined_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Opt_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">])</span>
                    <span class="n">CT_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                    <span class="n">EQE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Please select valid fit settings.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_Opt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_CT</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_Opt</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Confirm lists are acceptable</span>

                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Start_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_Opt_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Stop_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_Opt_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Fit_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_Opt</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;R2_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_Opt</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Start_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_CT_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Stop_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_CT_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Fit_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_CT</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;R2_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_CT</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Covar_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_covar_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Covar_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT_covar_list</span>

                <span class="c1"># Add combined fit to dataFrame</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Total_R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_R2_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Total_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Energy_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EQE_list</span>

                <span class="c1"># Find best fit</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Determining Best Fit ...&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># Save fit data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_DoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">save_fit_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># User to pick folder &amp; name to save to</span>
                    <span class="n">save_fit</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving fit data.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">save_fit_file</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">save_fit</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">label</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_dF2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_dF1</span><span class="p">)</span>

                <span class="c1"># for x in np.arange(1, 6, 1):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Best Fit No. </span><span class="si">{}</span><span class="s1"> : &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="n">df_results</span> <span class="o">=</span> <span class="n">find_best_fit</span><span class="p">(</span><span class="n">df_both</span><span class="o">=</span><span class="n">df_results</span><span class="p">,</span>
                                               <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                               <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">,</span>
                                               <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                                               <span class="n">n_fit</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                               <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span><span class="p">,</span>
                                               <span class="n">save_fit</span><span class="o">=</span><span class="n">save_fit</span><span class="p">,</span>
                                               <span class="n">save_fit_file</span><span class="o">=</span><span class="n">save_fit_file</span>
                                               <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Gaussian fitting function for double fit</span>

<div class="viewcode-block" id="MainWindow.gaussian_double"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_double">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_double</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory to separately fit double peaks</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_double</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">))</span></div>


<div class="viewcode-block" id="MainWindow.gaussian_disorder_double"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_disorder_double">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_disorder_double</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory including disorder to separately fit double peaks</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>
<span class="sd">        sig : float, required</span>
<span class="sd">            Gaussian disorder</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_double</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">((</span><span class="n">Ect</span> <span class="o">-</span> <span class="p">(</span><span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">))</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="p">(</span><span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_double</span><span class="p">))</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_double</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Simultaneous Double Peak Fit</span>

    <span class="c1"># Function to perform simultaneous double peak fitting once</span>

<div class="viewcode-block" id="MainWindow.sim_double_fit_single"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.sim_double_fit_single">[docs]</a>    <span class="k">def</span> <span class="nf">sim_double_fit_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to perform simultaneous double peak fitting for one energy range</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Import relevant parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_Sim</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">eqe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Temperature_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">bound_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sim_dict</span><span class="p">()</span>

        <span class="c1"># Compile EQE data</span>
        <span class="n">energy_fit</span><span class="p">,</span> <span class="n">eqe_fit</span> <span class="o">=</span> <span class="n">compile_Data</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="n">eqe</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                                           <span class="n">y</span><span class="o">=</span><span class="n">eqe</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">],</span>
                                           <span class="n">startE</span><span class="o">=</span><span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;start_fit&#39;</span><span class="p">],</span>
                                           <span class="n">stopE</span><span class="o">=</span><span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;stop_fit&#39;</span><span class="p">]</span>
                                           <span class="p">)</span>
        <span class="c1"># Set plot range</span>
        <span class="n">x_plot</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;start_plot&#39;</span><span class="p">],</span> <span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;stop_plot&#39;</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_guess_sig</span>
            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">fit_model_double</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder_double_sim</span><span class="p">,</span>
                                                                  <span class="n">energy_fit</span><span class="o">=</span><span class="n">energy_fit</span><span class="p">,</span>
                                                                  <span class="n">eqe_fit</span><span class="o">=</span><span class="n">eqe_fit</span><span class="p">,</span>
                                                                  <span class="n">bound_dict</span><span class="o">=</span><span class="n">bound_dict</span><span class="p">,</span>
                                                                  <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                                                                  <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span><span class="p">,</span>
                                                                  <span class="n">print_report</span><span class="o">=</span><span class="kc">False</span>
                                                                  <span class="p">)</span>
            <span class="n">y_CT</span> <span class="o">=</span> <span class="p">[</span><span class="n">calculate_gaussian_disorder_absorption</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                                           <span class="n">f</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">l</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                           <span class="n">E</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                           <span class="n">sig</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                                           <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span>
                                                           <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_plot</span><span class="p">]</span>
            <span class="n">y_sum</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder_double_sim</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                                       <span class="n">fCT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">lCT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">ECT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                       <span class="n">fopt</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                       <span class="n">lopt</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                                       <span class="n">Eopt</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                                       <span class="n">sig</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                                                       <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_plot</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_guess</span>
            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">fit_model_double</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double_sim</span><span class="p">,</span>
                                                                  <span class="n">energy_fit</span><span class="o">=</span><span class="n">energy_fit</span><span class="p">,</span>
                                                                  <span class="n">eqe_fit</span><span class="o">=</span><span class="n">eqe_fit</span><span class="p">,</span>
                                                                  <span class="n">bound_dict</span><span class="o">=</span><span class="n">bound_dict</span><span class="p">,</span>
                                                                  <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                                                                  <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span><span class="p">,</span>
                                                                  <span class="n">print_report</span><span class="o">=</span><span class="kc">False</span>
                                                                  <span class="p">)</span>
            <span class="n">y_CT</span> <span class="o">=</span> <span class="p">[</span><span class="n">calculate_gaussian_absorption</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                                  <span class="n">f</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="n">l</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                  <span class="n">E</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                  <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span>
                                                  <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_plot</span><span class="p">]</span>
            <span class="n">y_sum</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double_sim</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                              <span class="n">fCT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">lCT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="n">ECT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                              <span class="n">fopt</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                              <span class="n">lopt</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                              <span class="n">Eopt</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                              <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_plot</span><span class="p">]</span>

        <span class="n">y_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">calculate_gaussian_absorption</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                               <span class="n">f</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                               <span class="n">l</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                               <span class="n">E</span><span class="o">=</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                               <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span>
                                               <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_plot</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">35</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2 : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">r_squared</span><span class="p">,</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">35</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;f_Opt (eV**2) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;l_Opt (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E_Opt (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">35</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;f_CT (eV**2) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;l_CT (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E_CT (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sigma (eV) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;.6f&#39;</span><span class="p">),</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]),</span> <span class="s1">&#39;.6f&#39;</span><span class="p">))</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">+</span> <span class="p">(</span><span class="n">best_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gaussian Variance [W] (eV K) : &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="s1">&#39;.2f&#39;</span><span class="p">))</span>

        <span class="c1"># print(&#39;Temperature [T] (K) : &#39;, T)</span>
        <span class="c1"># print(&#39;-&#39; * 80)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_simFit_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_simFit</span><span class="p">)</span>

        <span class="n">axDouble_1</span><span class="p">,</span> <span class="n">axDouble_2</span> <span class="o">=</span> <span class="n">set_up_plot</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>

        <span class="n">axDouble_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eqe</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                        <span class="n">eqe</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">],</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span>
                        <span class="n">y_opt</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Optical Peak Fit&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span>
                        <span class="n">y_CT</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CT State Fit&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span>
                        <span class="n">y_sum</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashdot&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total Fit&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">axDouble_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eqe</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span>
                        <span class="n">eqe</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">],</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span>
                        <span class="n">y_opt</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Optical Peak Fit&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span>
                        <span class="n">y_CT</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CT State Fit&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span>
                        <span class="n">y_sum</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashdot&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total Fit&#39;</span>
                        <span class="p">)</span>
        <span class="n">axDouble_2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">eqe</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">])</span>
        <span class="n">axDouble_2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_simDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">opt_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">opt_file</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_plot</span>
            <span class="n">opt_file</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_opt</span>
            <span class="n">opt_file</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span>
            <span class="n">opt_file</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">opt_file</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">opt_file</span><span class="p">[</span><span class="s1">&#39;Optical Peak Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

            <span class="n">CT_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">CT_file</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_plot</span>
            <span class="n">CT_file</span><span class="p">[</span><span class="s1">&#39;Signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_CT</span>
            <span class="n">CT_file</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span>
            <span class="n">CT_file</span><span class="p">[</span><span class="s1">&#39;Oscillator Strength (eV**2)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">CT_file</span><span class="p">[</span><span class="s1">&#39;Reorganization Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">CT_file</span><span class="p">[</span><span class="s1">&#39;CT State Energy (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                <span class="n">CT_file</span><span class="p">[</span><span class="s1">&#39;Sigma (eV)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

            <span class="n">save_fit_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># User to pick folder &amp; name to save to</span>
            <span class="n">save_fit_path</span><span class="p">,</span> <span class="n">save_fit_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">save_fit_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">save_fit_path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check if the user actually selected a path</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">save_fit_path</span><span class="p">)</span>  <span class="c1"># Change the working directory</span>
                <span class="n">opt_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_fit_filename</span><span class="si">}</span><span class="s1">_Fit_simDouble_Opt&#39;</span><span class="p">)</span>  <span class="c1"># Save data to csv</span>
                <span class="n">CT_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_fit_filename</span><span class="si">}</span><span class="s1">_Fit_simDouble_CT&#39;</span><span class="p">)</span>  <span class="c1"># Save data to csv</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving fit data to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_fit_file</span><span class="p">))</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>  <span class="c1"># Change the directory back</span></div>


    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to perform simultaneous double peak fitting multiple times</span>

<div class="viewcode-block" id="MainWindow.sim_double_fit"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.sim_double_fit">[docs]</a>    <span class="k">def</span> <span class="nf">sim_double_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to perform simultaneous double peak fitting for multiple energy ranges</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Import relevant parameters</span>
        <span class="n">eqe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">Temperature_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">bound_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sim_dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_Sim</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bias_SimFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias_sim</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sim</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tolerance_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Constraining fit below EQE data.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias_sim</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Not constraining fit.&#39;</span><span class="p">)</span>

        <span class="c1"># Check that all start and stop energies are valid</span>
        <span class="c1"># start_ok = StartStop_is_valid(bound_dict[&#39;start_start&#39;], bound_dict[&#39;start_stop&#39;])</span>
        <span class="c1"># stop_ok = StartStop_is_valid(bound_dict[&#39;stop_start&#39;], bound_dict[&#39;stop_stop&#39;])</span>

        <span class="n">start_ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">stop_ok</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Compile all start / stop energies for CT fit</span>
        <span class="k">if</span> <span class="n">start_ok</span> <span class="ow">and</span> <span class="n">stop_ok</span><span class="p">:</span>

            <span class="n">startRange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;start_start&#39;</span><span class="p">],</span>
                                            <span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;start_stop&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span>
                                            <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">stopRange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;stop_start&#39;</span><span class="p">],</span>
                                           <span class="n">bound_dict</span><span class="p">[</span><span class="s1">&#39;stop_stop&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span>
                                           <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="c1"># Compile a dataFrame with all combinations of start / stop values for the optical and CT fit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Compiling Fit Ranges ...&#39;</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="n">start_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">startRange</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">stopRange</span><span class="p">:</span>
                    <span class="n">start_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                    <span class="n">stop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>

            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_list</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_list</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating Fits ...&#39;</span><span class="p">)</span>

            <span class="n">best_vals_Opt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">best_vals_CT</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">covar_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">start_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">R2_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">R2_CT_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">R2_sum_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">R2_average_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">Opt_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">CT_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">combined_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Energy_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">EQE_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]:</span>
                    <span class="n">wave_fit</span><span class="p">,</span> <span class="n">energy_fit</span><span class="p">,</span> <span class="n">eqe_fit</span><span class="p">,</span> <span class="n">log_eqe_fit</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">eqe</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_guess_sig</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">fit_model_double</span><span class="p">(</span>
                                                                            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_disorder_double_sim</span><span class="p">,</span>
                                                                            <span class="n">energy_fit</span><span class="o">=</span><span class="n">energy_fit</span><span class="p">,</span>
                                                                            <span class="n">eqe_fit</span><span class="o">=</span><span class="n">eqe_fit</span><span class="p">,</span>
                                                                            <span class="n">bound_dict</span><span class="o">=</span><span class="n">bound_dict</span><span class="p">,</span>
                                                                            <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                                                                            <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span><span class="p">,</span>
                                                                            <span class="n">print_report</span><span class="o">=</span><span class="kc">False</span>
                                                                            <span class="p">)</span>
                            <span class="n">best_CT</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                            <span class="p">]</span>
                            <span class="n">best_Opt</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">best_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_guess</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">fit_model_double</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_double_sim</span><span class="p">,</span>
                                                                                  <span class="n">energy_fit</span><span class="o">=</span><span class="n">energy_fit</span><span class="p">,</span>
                                                                                  <span class="n">eqe_fit</span><span class="o">=</span><span class="n">eqe_fit</span><span class="p">,</span>
                                                                                  <span class="n">bound_dict</span><span class="o">=</span><span class="n">bound_dict</span><span class="p">,</span>
                                                                                  <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                                                                                  <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span><span class="p">,</span>
                                                                                  <span class="n">print_report</span><span class="o">=</span><span class="kc">False</span>
                                                                                  <span class="p">)</span>
                            <span class="n">best_CT</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="p">]</span>
                            <span class="n">best_Opt</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                <span class="n">best_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">best_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">best_vals</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check that the fit was successful</span>
                        <span class="c1"># Calculate combined fit here</span>
                        <span class="n">parameter_dict</span> <span class="o">=</span> <span class="n">calculate_combined_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                <span class="n">stopE</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">best_vals_Opt</span><span class="o">=</span><span class="n">best_Opt</span><span class="p">,</span>
                                                                <span class="n">best_vals_CT</span><span class="o">=</span><span class="n">best_CT</span><span class="p">,</span>
                                                                <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span><span class="p">,</span>
                                                                <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_sim</span><span class="p">,</span>
                                                                <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sim</span><span class="p">,</span>
                                                                <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span>
                                                                <span class="p">)</span>

                        <span class="n">covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>

                        <span class="n">start_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">stop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">best_vals_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_CT</span><span class="p">)</span>
                        <span class="n">best_vals_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_Opt</span><span class="p">)</span>

                        <span class="n">R2_sum_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Combined&#39;</span><span class="p">])</span>
                        <span class="n">R2_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Opt&#39;</span><span class="p">])</span>
                        <span class="n">R2_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_CT&#39;</span><span class="p">])</span>
                        <span class="n">R2_average_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Average&#39;</span><span class="p">])</span>

                        <span class="n">combined_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Combined_Fit&#39;</span><span class="p">])</span>
                        <span class="n">Opt_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">])</span>
                        <span class="n">CT_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">])</span>
                        <span class="n">Energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                        <span class="n">EQE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span>

                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># If sum was unsuccessful, skip and move on</span>
                        <span class="k">pass</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_Opt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_CT</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_Opt</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Fit_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_Opt</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;R2_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_Opt_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Fit_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_CT</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;R2_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_CT_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">covar_list</span>

                <span class="c1"># Add combined fit to dataFrame</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Total_R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_sum_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Total_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Energy_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EQE_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Comp_R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_average_list</span>

                <span class="c1"># Find best fit</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Determining Best Fit ...&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># Save fit data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_simDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">save_fit_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># User to pick folder &amp; name to save to</span>
                    <span class="n">save_fit</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving fit data.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">save_fit_file</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">save_fit</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">label</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_simFit_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_simFit</span><span class="p">)</span>

                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">n_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Best Fit No. </span><span class="si">{}</span><span class="s1"> : &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="n">df_results</span> <span class="o">=</span> <span class="n">find_best_fit</span><span class="p">(</span><span class="n">df_both</span><span class="o">=</span><span class="n">df_results</span><span class="p">,</span>
                                               <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                               <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span><span class="p">,</span>
                                               <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                                               <span class="n">n_fit</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                               <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span><span class="p">,</span>
                                               <span class="n">simultaneous_double</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">save_fit</span><span class="o">=</span><span class="n">save_fit</span><span class="p">,</span>
                                               <span class="n">save_fit_file</span><span class="o">=</span><span class="n">save_fit_file</span>
                                               <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to load dictionary of fit bounds</span>

<div class="viewcode-block" id="MainWindow.load_sim_dict"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.load_sim_dict">[docs]</a>    <span class="k">def</span> <span class="nf">load_sim_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to load dictionary of fit bounds from GUI paramaters</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">start_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startFit_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopFit_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">start_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startPlot_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopPlot_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">start_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStart_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">start_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startStop_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStart_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopStop_Sim</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">start_Eopt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startBound_Eopt</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_Eopt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopBound_Eopt</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">start_fopt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startBound_fopt</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_fopt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopBound_fopt</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">start_lopt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startBound_lopt</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_lopt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopBound_lopt</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">start_ECT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startBound_ECT</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_ECT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopBound_ECT</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">start_fCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startBound_fCT</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_fCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopBound_fCT</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">start_lCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startBound_lCT</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_lCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopBound_lCT</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">start_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">startBound_sig</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">stop_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopBound_sig</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">bound_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;start_Eopt&#39;</span><span class="p">:</span> <span class="n">start_Eopt</span><span class="p">,</span>
            <span class="s1">&#39;stop_Eopt&#39;</span><span class="p">:</span> <span class="n">stop_Eopt</span><span class="p">,</span>
            <span class="s1">&#39;start_fopt&#39;</span><span class="p">:</span> <span class="n">start_fopt</span><span class="p">,</span>
            <span class="s1">&#39;stop_fopt&#39;</span><span class="p">:</span> <span class="n">stop_fopt</span><span class="p">,</span>
            <span class="s1">&#39;start_lopt&#39;</span><span class="p">:</span> <span class="n">start_lopt</span><span class="p">,</span>
            <span class="s1">&#39;stop_lopt&#39;</span><span class="p">:</span> <span class="n">stop_lopt</span><span class="p">,</span>
            <span class="s1">&#39;start_ECT&#39;</span><span class="p">:</span> <span class="n">start_ECT</span><span class="p">,</span>
            <span class="s1">&#39;stop_ECT&#39;</span><span class="p">:</span> <span class="n">stop_ECT</span><span class="p">,</span>
            <span class="s1">&#39;start_fCT&#39;</span><span class="p">:</span> <span class="n">start_fCT</span><span class="p">,</span>
            <span class="s1">&#39;stop_fCT&#39;</span><span class="p">:</span> <span class="n">stop_fCT</span><span class="p">,</span>
            <span class="s1">&#39;start_lCT&#39;</span><span class="p">:</span> <span class="n">start_lCT</span><span class="p">,</span>
            <span class="s1">&#39;stop_lCT&#39;</span><span class="p">:</span> <span class="n">stop_lCT</span><span class="p">,</span>
            <span class="s1">&#39;start_sig&#39;</span><span class="p">:</span> <span class="n">start_sig</span><span class="p">,</span>
            <span class="s1">&#39;stop_sig&#39;</span><span class="p">:</span> <span class="n">stop_sig</span><span class="p">,</span>
            <span class="s1">&#39;start_fit&#39;</span><span class="p">:</span> <span class="n">start_fit</span><span class="p">,</span>
            <span class="s1">&#39;stop_fit&#39;</span><span class="p">:</span> <span class="n">stop_fit</span><span class="p">,</span>
            <span class="s1">&#39;start_plot&#39;</span><span class="p">:</span> <span class="n">start_plot</span><span class="p">,</span>
            <span class="s1">&#39;stop_plot&#39;</span><span class="p">:</span> <span class="n">stop_plot</span><span class="p">,</span>
            <span class="s1">&#39;start_start&#39;</span><span class="p">:</span> <span class="n">start_start</span><span class="p">,</span>
            <span class="s1">&#39;start_stop&#39;</span><span class="p">:</span> <span class="n">start_stop</span><span class="p">,</span>
            <span class="s1">&#39;stop_start&#39;</span><span class="p">:</span> <span class="n">stop_start</span><span class="p">,</span>
            <span class="s1">&#39;stop_stop&#39;</span><span class="p">:</span> <span class="n">stop_stop</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">bound_dict</span></div>

    <span class="c1"># # -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Gaussian fitting function for simultaneous double peak fit</span>

<div class="viewcode-block" id="MainWindow.gaussian_double_sim"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_double_sim">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_double_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">fCT</span><span class="p">,</span> <span class="n">lCT</span><span class="p">,</span> <span class="n">ECT</span><span class="p">,</span> <span class="n">fopt</span><span class="p">,</span> <span class="n">lopt</span><span class="p">,</span> <span class="n">Eopt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory to simultaneously fit double peaks</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        fCT : float, required</span>
<span class="sd">            CT state oscillator strength</span>
<span class="sd">        lCT : float, required</span>
<span class="sd">            CT state reorganization energy</span>
<span class="sd">        ECT : float, required</span>
<span class="sd">            CT state energy</span>
<span class="sd">        fopt : float, required</span>
<span class="sd">            S1 peak oscillator strength</span>
<span class="sd">        lopt : float, required</span>
<span class="sd">            S1 peak reorganization energy</span>
<span class="sd">        Eopt : float, required</span>
<span class="sd">            S1 peak energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">val_CT</span> <span class="o">=</span> <span class="p">(</span><span class="n">fCT</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">lCT</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">ECT</span> <span class="o">+</span> <span class="n">lCT</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">lCT</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span><span class="p">))</span>
        <span class="n">val_opt</span> <span class="o">=</span> <span class="p">(</span><span class="n">fopt</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">lopt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Eopt</span> <span class="o">+</span> <span class="n">lopt</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">lopt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">val_CT</span> <span class="o">+</span> <span class="n">val_opt</span></div>

    <span class="c1"># Gaussian fitting function for simultaneous double peak fit including disorder</span>

<div class="viewcode-block" id="MainWindow.gaussian_disorder_double_sim"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.gaussian_disorder_double_sim">[docs]</a>    <span class="k">def</span> <span class="nf">gaussian_disorder_double_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">fCT</span><span class="p">,</span> <span class="n">lCT</span><span class="p">,</span> <span class="n">ECT</span><span class="p">,</span> <span class="n">fopt</span><span class="p">,</span> <span class="n">lopt</span><span class="p">,</span> <span class="n">Eopt</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus theory including disorder to simultaneously fit double peaks</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        fCT : float, required</span>
<span class="sd">            CT state oscillator strength</span>
<span class="sd">        lCT : float, required</span>
<span class="sd">            CT state reorganization energy</span>
<span class="sd">        ECT : float, required</span>
<span class="sd">            CT state energy</span>
<span class="sd">        fopt : float, required</span>
<span class="sd">            S1 peak oscillator strength</span>
<span class="sd">        lopt : float, required</span>
<span class="sd">            S1 peak reorganization energy</span>
<span class="sd">        Eopt : float, required</span>
<span class="sd">            S1 peak energy</span>
<span class="sd">        sig : float, required</span>
<span class="sd">            Gaussian disorder</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">val_CT</span> <span class="o">=</span> <span class="p">(</span><span class="n">fCT</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lCT</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">ECT</span> <span class="o">+</span> <span class="n">lCT</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">lCT</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">val_opt</span> <span class="o">=</span> <span class="p">(</span><span class="n">fopt</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">lopt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Eopt</span> <span class="o">+</span> <span class="n">lopt</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">lopt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_sim</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">val_CT</span> <span class="o">+</span> <span class="n">val_opt</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Page 5 - Extended Fits (MLJ Theory)</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Separate Double Peak Fit</span>

    <span class="c1"># Function to compile fits for separate double peak fitting</span>

<div class="viewcode-block" id="MainWindow.double_fit_MLJ"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.double_fit_MLJ">[docs]</a>    <span class="k">def</span> <span class="nf">double_fit_MLJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function for separate double peak fitting of S1 and CT state peaks using MLJ theory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">increase_factor</span> <span class="o">=</span> <span class="mf">1.05</span>  <span class="c1"># NOTE: Modify to increase data range for R2 calculation and fit selection</span>
        <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">guessRange_Sig</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Import relevant parameters</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bias_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraDouble_Tolerance</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Constraining fit below EQE data.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Not constraining fit.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">disorder_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">include_disorder</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">startGuess_Sig</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStartSig_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="n">stopGuess_Sig</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStopSig_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="n">guessSig_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startGuess_Sig</span><span class="p">,</span> <span class="n">stopGuess_Sig</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">guessSig_ok</span><span class="p">:</span>
                <span class="c1"># guessRange_Sig = np.round(np.arange(startGuess_Sig, stopGuess_Sig + 0.05, 0.05), 3).tolist()</span>
                <span class="n">guessRange_Sig</span> <span class="o">=</span> <span class="p">[</span><span class="n">startGuess_Sig</span><span class="p">,</span> <span class="n">stopGuess_Sig</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># guessRange_Sig = np.round(np.arange(startGuess_Sig, startGuess_Sig + 0.05, 0.05), 3).tolist()</span>
                <span class="n">guessRange_Sig</span> <span class="o">=</span> <span class="p">[</span><span class="n">startGuess_Sig</span><span class="p">,</span> <span class="n">stopGuess_Sig</span><span class="p">]</span>

        <span class="n">eqe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_extraDouble</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraDouble_Temperature</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_Double</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraDouble_vibEnergy</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraDouble_HuangRhys</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">startStart_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStartStart_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">startStop_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStartStop_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStart_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStopStart_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStop_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStopStop_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

        <span class="n">startStart_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStartStart_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">startStop_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStartStop_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStart_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStopStart_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopStop_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraStopStop_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

        <span class="n">startGuess_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStart_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopGuess_Opt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStop_Opt</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">startGuess_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStart_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">stopGuess_CT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">extraGuessStop_CT</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

        <span class="c1"># Check that all start and stop energies are valid</span>

        <span class="c1"># startOpt_ok = StartStop_is_valid(startStart_Opt, startStop_Opt)</span>
        <span class="c1"># stopOpt_ok = StartStop_is_valid(stopStart_Opt, stopStop_Opt)</span>

        <span class="n">startOpt_ok</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Checks removed to allow same start/stop value</span>
        <span class="n">stopOpt_ok</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># startCT_ok = StartStop_is_valid(startStart_CT, startStop_CT)</span>
        <span class="c1"># stopCT_ok = StartStop_is_valid(stopStart_CT, stopStop_CT)</span>

        <span class="n">startCT_ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">stopCT_ok</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">guessOpt_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startGuess_Opt</span><span class="p">,</span> <span class="n">stopGuess_Opt</span><span class="p">)</span>
        <span class="n">guessCT_ok</span> <span class="o">=</span> <span class="n">StartStop_is_valid</span><span class="p">(</span><span class="n">startGuess_CT</span><span class="p">,</span> <span class="n">stopGuess_CT</span><span class="p">)</span>

        <span class="c1"># Compile all start / stop energies for Opt and CT fit</span>

        <span class="k">if</span> <span class="n">startOpt_ok</span> <span class="ow">and</span> <span class="n">stopOpt_ok</span> <span class="ow">and</span> <span class="n">guessOpt_ok</span> <span class="ow">and</span> <span class="n">startCT_ok</span> <span class="ow">and</span> <span class="n">stopCT_ok</span> <span class="ow">and</span> <span class="n">guessCT_ok</span><span class="p">:</span>

            <span class="n">startRange_Opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startStart_Opt</span><span class="p">,</span> <span class="n">startStop_Opt</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># Change step to 0.05</span>
            <span class="n">stopRange_Opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stopStart_Opt</span><span class="p">,</span> <span class="n">stopStop_Opt</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">startRange_CT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startStart_CT</span><span class="p">,</span> <span class="n">startStop_CT</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">stopRange_CT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stopStart_CT</span><span class="p">,</span> <span class="n">stopStop_CT</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">guessRange_Opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startGuess_Opt</span><span class="p">,</span> <span class="n">stopGuess_Opt</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">guessRange_CT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">startGuess_CT</span><span class="p">,</span> <span class="n">stopGuess_CT</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="c1"># Compile a dataFrame with all combinations of start / stop values for Opt and CT fit</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Compiling Fit Ranges ...&#39;</span><span class="p">)</span>

            <span class="n">df_Opt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">df_CT</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="n">start_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start_CT_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_CT_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">startOpt</span> <span class="ow">in</span> <span class="n">startRange_Opt</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stopOpt</span> <span class="ow">in</span> <span class="n">stopRange_Opt</span><span class="p">:</span>
                    <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">startOpt</span><span class="p">)</span>
                    <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stopOpt</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">startCT</span> <span class="ow">in</span> <span class="n">startRange_CT</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stopCT</span> <span class="ow">in</span> <span class="n">stopRange_CT</span><span class="p">:</span>
                    <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">startCT</span><span class="p">)</span>
                    <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stopCT</span><span class="p">)</span>

            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_Opt_list</span>
            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_Opt_list</span>

            <span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_CT_list</span>
            <span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_CT_list</span>

            <span class="c1"># Calculate all optical peak fits</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating Optical Peak Fits ...&#39;</span><span class="p">)</span>

            <span class="n">cal_vals_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_guess_fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                                                  <span class="n">df</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">,</span>
                                                                  <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                  <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double_gaussian</span><span class="p">,</span>
                                                                  <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_Opt</span>
                                                                  <span class="p">),</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">)))))</span>

            <span class="n">best_vals_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">list_</span><span class="p">:</span> <span class="n">sep_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cal_vals_Opt</span><span class="p">))</span>
            <span class="n">covar_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">list_</span><span class="p">:</span> <span class="n">sep_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cal_vals_Opt</span><span class="p">))</span>
            <span class="n">R2_Opt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">list_</span><span class="p">:</span> <span class="n">sep_list</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">cal_vals_Opt</span><span class="p">))</span>

            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_Opt</span>
            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">covar_Opt</span>
            <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_Opt</span>

            <span class="c1"># Calculate CT state fits</span>

            <span class="n">start_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_Opt_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start_CT_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">stop_CT_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">best_vals_Opt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">best_vals_CT</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">Opt_covar_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">CT_covar_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">R2_Opt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">R2_CT</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">combined_R2_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">Opt_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">CT_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">combined_Fit_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Energy_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">EQE_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating CT State Fits ...&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Including CT State Disorder ...&#39;</span><span class="p">)</span>

            <span class="c1"># If Optical peak to be subtracted before CT fit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">subtract_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bestSubtract_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Subtracting All Optical Peak Fits ...&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">))):</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_CT</span><span class="p">))):</span>
                        <span class="k">if</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Check that the optical peak fit was successful</span>

                            <span class="n">new_eqe</span> <span class="o">=</span> <span class="n">subtract_Opt</span><span class="p">(</span><span class="n">eqe</span><span class="p">,</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                                <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                            <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double_disorder</span><span class="p">,</span>
                                                                            <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                            <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">guessRange_Sig</span><span class="p">,</span>
                                                                            <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                            <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># to use fit model</span>
                                                                            <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                            <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                            <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double</span><span class="p">,</span>
                                                                            <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                            <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                            <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function</span>
                                                                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                            <span class="n">r_squared</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="n">Opt_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">CT_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>
                        <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                        <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                        <span class="n">best_vals_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">best_vals_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">)</span>
                        <span class="n">R2_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                        <span class="n">R2_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>

                        <span class="c1"># Calculate combined fit here</span>
                        <span class="n">parameter_dict</span> <span class="o">=</span> <span class="n">calculate_combined_fit_MLJ</span><span class="p">(</span><span class="n">stopE</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                    <span class="n">best_vals_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                    <span class="n">best_vals_CT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">,</span>
                                                                    <span class="n">R2_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                    <span class="n">R2_CT</span><span class="o">=</span><span class="n">r_squared</span><span class="p">,</span>
                                                                    <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                    <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">,</span>
                                                                    <span class="n">S</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span><span class="p">,</span>
                                                                    <span class="n">hbarw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hbarw_Double</span><span class="p">,</span>
                                                                    <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
                                                                    <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
                                                                    <span class="nb">range</span><span class="o">=</span><span class="n">increase_factor</span><span class="p">,</span>
                                                                    <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span>
                                                                    <span class="p">)</span>

                        <span class="n">combined_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Combined&#39;</span><span class="p">])</span>
                        <span class="n">combined_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Combined_Fit&#39;</span><span class="p">])</span>
                        <span class="n">Opt_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">])</span>
                        <span class="n">CT_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">])</span>
                        <span class="n">Energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                        <span class="n">EQE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span>

            <span class="c1"># If only best Optical peak is to be subtracted before CT fit</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bestSubtract_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">subtract_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Subtracting Only Best Optical Peak Fit ...&#39;</span><span class="p">)</span>

                <span class="c1"># best_fit_index = df_Opt[&#39;Fit&#39;][df_Opt[&#39;R2&#39;]==max(df_Opt[&#39;R2&#39;])].index[0]</span>
                <span class="c1"># print(best_fit_index)</span>

                <span class="c1"># To avoid picking a fit that has a high R2 but moves above the data</span>
                <span class="n">advanced_R2_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">)):</span>
                    <span class="n">wave_fit</span><span class="p">,</span> <span class="n">energy_fit</span><span class="p">,</span> <span class="n">eqe_fit</span><span class="p">,</span> <span class="n">log_eqe_fit</span> <span class="o">=</span> <span class="n">compile_EQE</span><span class="p">(</span><span class="n">eqe</span><span class="p">,</span>
                                                                             <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                             <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">increase_factor</span><span class="p">,</span>
                                                                             <span class="mi">1</span><span class="p">)</span>
                    <span class="n">y_fit</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double_gaussian</span><span class="p">(</span><span class="n">e</span><span class="p">,</span>
                                                      <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                      <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                                                      <span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">energy_fit</span><span class="p">]</span>
                    <span class="n">advanced_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_squared</span><span class="p">(</span><span class="n">eqe_fit</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">))</span>

                <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Advanced R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">advanced_R2_list</span>

                <span class="n">best_fit_index</span> <span class="o">=</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Advanced R2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Advanced R2&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># print(best_fit_index)</span>

                <span class="n">new_eqe</span> <span class="o">=</span> <span class="n">subtract_Opt</span><span class="p">(</span><span class="n">eqe</span><span class="p">,</span> <span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">],</span> <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_CT</span><span class="p">))):</span>

                    <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                        <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                    <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double_disorder</span><span class="p">,</span>
                                                                    <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                    <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">guessRange_Sig</span><span class="p">,</span>
                                                                    <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                    <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># to use fit model</span>
                                                                    <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">new_eqe</span><span class="p">,</span>
                                                                    <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                    <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double</span><span class="p">,</span>
                                                                    <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                    <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                    <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function</span>
                                                                    <span class="p">)</span>

                    <span class="n">Opt_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">CT_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>
                    <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">best_vals_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">best_vals_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">)</span>
                    <span class="n">R2_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">best_fit_index</span><span class="p">])</span>
                    <span class="n">R2_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>

                    <span class="c1"># Calculate combined fit here</span>
                    <span class="n">parameter_dict</span> <span class="o">=</span> <span class="n">calculate_combined_fit_MLJ</span><span class="p">(</span><span class="n">stopE</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">best_vals_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">best_vals_CT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">,</span>
                                                                <span class="n">R2_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">R2_CT</span><span class="o">=</span><span class="n">r_squared</span><span class="p">,</span>
                                                                <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">,</span>
                                                                <span class="n">S</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span><span class="p">,</span>
                                                                <span class="n">hbarw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hbarw_Double</span><span class="p">,</span>
                                                                <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
                                                                <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
                                                                <span class="nb">range</span><span class="o">=</span><span class="n">increase_factor</span><span class="p">,</span>
                                                                <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span>
                                                                <span class="p">)</span>

                    <span class="n">combined_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Combined&#39;</span><span class="p">])</span>
                    <span class="n">combined_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Combined_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Opt_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">])</span>
                    <span class="n">CT_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                    <span class="n">EQE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span>

            <span class="c1"># If Optical peak not to be subtracted before CT fit</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">subtract_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">bestSubtract_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Not Subtracting Optical Peak Fits.&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">))):</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_CT</span><span class="p">))):</span>

                        <span class="k">if</span> <span class="n">include_disorder</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                        <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double_disorder</span><span class="p">,</span>
                                                                        <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                        <span class="n">guessRange_sig</span><span class="o">=</span><span class="n">guessRange_Sig</span><span class="p">,</span>
                                                                        <span class="n">include_disorder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                        <span class="n">bounds</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># to use fit model</span>
                                                                        <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">best_vals</span><span class="p">,</span> <span class="n">covar</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">r_squared</span> <span class="o">=</span> <span class="n">guess_fit</span><span class="p">(</span><span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                        <span class="n">startE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">stopE</span><span class="o">=</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                                                                        <span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MLJ_double</span><span class="p">,</span>
                                                                        <span class="n">guessRange</span><span class="o">=</span><span class="n">guessRange_CT</span><span class="p">,</span>
                                                                        <span class="n">include_disorder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                        <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># to use fit function</span>
                                                                        <span class="p">)</span>
                    <span class="n">Opt_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Covar&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">CT_covar_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>
                    <span class="n">start_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">stop_Opt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">start_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">stop_CT_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_CT</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">best_vals_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">best_vals_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_vals</span><span class="p">)</span>
                    <span class="n">R2_Opt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
                    <span class="n">R2_CT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_squared</span><span class="p">)</span>

                    <span class="c1"># Calculate combined fit here</span>
                    <span class="n">parameter_dict</span> <span class="o">=</span> <span class="n">calculate_combined_fit_MLJ</span><span class="p">(</span><span class="n">stopE</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Stop&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">best_vals_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;Fit&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">best_vals_CT</span><span class="o">=</span><span class="n">best_vals</span><span class="p">,</span>
                                                                <span class="n">R2_Opt</span><span class="o">=</span><span class="n">df_Opt</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                                                <span class="n">R2_CT</span><span class="o">=</span><span class="n">r_squared</span><span class="p">,</span>
                                                                <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                                                <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">,</span>
                                                                <span class="n">S</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span><span class="p">,</span>
                                                                <span class="n">hbarw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hbarw_Double</span><span class="p">,</span>
                                                                <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span>
                                                                <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
                                                                <span class="nb">range</span><span class="o">=</span><span class="n">increase_factor</span><span class="p">,</span>
                                                                <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span>
                                                                <span class="p">)</span>

                    <span class="n">combined_R2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;R2_Combined&#39;</span><span class="p">])</span>
                    <span class="n">combined_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Combined_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Opt_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">])</span>
                    <span class="n">CT_Fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">])</span>
                    <span class="n">Energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                    <span class="n">EQE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Please select valid fit settings.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_Opt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_CT</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vals_Opt</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Confirm lists are acceptable</span>

                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Start_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_Opt_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Stop_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_Opt_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Fit_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_Opt</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;R2_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_Opt</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Start_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_CT_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Stop_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_CT_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Fit_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_vals_CT</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;R2_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_CT</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Covar_Opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_covar_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Covar_CT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT_covar_list</span>

                <span class="c1"># Add combined fit to dataFrame</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Total_R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_R2_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Total_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Opt_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;CT_Fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT_Fit_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Energy_list</span>
                <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;EQE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EQE_list</span>

                <span class="c1"># Find best fit</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Determining Best Fit ...&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fit Results: &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># Save fit data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_extraDoubleFit</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">save_fit_file</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>  <span class="c1"># User to pick folder &amp; name to save to</span>
                    <span class="n">save_fit</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving fit data.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">save_fit_file</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">save_fit</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">label</span> <span class="o">=</span> <span class="n">pick_EQE_Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_extraDouble_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">textBox_extraDouble</span><span class="p">)</span>

                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">n_Extra</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Best Fit No. </span><span class="si">{}</span><span class="s1"> : &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="n">df_results</span> <span class="o">=</span> <span class="n">find_best_fit</span><span class="p">(</span><span class="n">df_both</span><span class="o">=</span><span class="n">df_results</span><span class="p">,</span>
                                               <span class="n">eqe</span><span class="o">=</span><span class="n">eqe</span><span class="p">,</span>
                                               <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">,</span>
                                               <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                                               <span class="n">n_fit</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                               <span class="n">include_disorder</span><span class="o">=</span><span class="n">include_disorder</span><span class="p">,</span>
                                               <span class="n">save_fit</span><span class="o">=</span><span class="n">save_fit</span><span class="p">,</span>
                                               <span class="n">save_fit_file</span><span class="o">=</span><span class="n">save_fit_file</span>
                                               <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Gaussian fitting function for double fit</span>

<div class="viewcode-block" id="MainWindow.MLJ_double_gaussian"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_double_gaussian">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_double_gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Eopt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory to separately fit double peaks</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Eopt : float, required</span>
<span class="sd">            S1 peak energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">Eopt</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">))</span></div>

    <span class="c1"># MLJ function</span>

<div class="viewcode-block" id="MainWindow.MLJ_double"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_double">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_double</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory for double peak fitting</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">EQE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EQE_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span> \
                    <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                    <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_Double</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                          <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span><span class="p">))</span>
            <span class="n">EQE</span> <span class="o">+=</span> <span class="n">EQE_n</span>
        <span class="k">return</span> <span class="n">EQE</span></div>

    <span class="c1"># MLJ function including disorder</span>

<div class="viewcode-block" id="MainWindow.MLJ_double_disorder"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.MLJ_double_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">MLJ_double_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Ect</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marcus-Levich-Jortner theory including disorder for double peak fitting</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : list, required</span>
<span class="sd">            List of energy values</span>
<span class="sd">        f : float, required</span>
<span class="sd">            Oscillator strength</span>
<span class="sd">        l : float, required</span>
<span class="sd">            Reorganization energy</span>
<span class="sd">        Ect : float, required</span>
<span class="sd">            CT state energy</span>
<span class="sd">        sig : float, required</span>
<span class="sd">            Gaussian disorder</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EQE : float</span>
<span class="sd">            EQE value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">EQE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="c1"># TODO: Check line breaks</span>
            <span class="n">EQE_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> \
                     <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_Double</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> \
                     <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ect</span> <span class="o">+</span> <span class="n">l</span> <span class="o">-</span> <span class="n">E</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbarw_Double</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
                           <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_xDouble</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="n">EQE</span> <span class="o">+=</span> <span class="n">EQE_n</span>
        <span class="k">return</span> <span class="n">EQE</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Functions to clear plots</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to clear &quot;Calculate EQE&quot; plot</span>

<div class="viewcode-block" id="MainWindow.clear_plot"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.clear_plot">[docs]</a>    <span class="k">def</span> <span class="nf">clear_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to clear plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Close the current plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">set_up_plot</span><span class="p">()</span>  <span class="c1"># Setting up new plot is preferred over plt.clf() in case window was closed</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to clear EQE plot</span>

<div class="viewcode-block" id="MainWindow.clear_EQE_plot"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.clear_EQE_plot">[docs]</a>    <span class="k">def</span> <span class="nf">clear_EQE_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to clear EQE fit plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axFit_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axFit_2</span> <span class="o">=</span> <span class="n">set_up_EQE_plot</span><span class="p">()</span></div>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------</span>

    <span class="c1"># Function to clear EL plot</span>

<div class="viewcode-block" id="MainWindow.clear_EL_plot"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.MainWindow.clear_EL_plot">[docs]</a>    <span class="k">def</span> <span class="nf">clear_EL_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to clear EL plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axEL_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axEL_2</span> <span class="o">=</span> <span class="n">set_up_EL_plot</span><span class="p">()</span></div></div>


<span class="c1"># -----------------------------------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../analysis_generated/sEQE_Analysis.html#sEQE_Analysis.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">monoUI</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
    <span class="n">monoUI</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, AFMD Group - notably Kate Trinkhaus for logo and Maximilian Hanauske for documentation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #244694; <!-- #F3631D -->
    }
    /* Sidebar */
    .wy-nav-side {
      background: #ffe95b; <!-- #343131 -->
    }
    
    /* Sidebar text */ 
    .wy-nav-side a {
    color: #818181;
    }
    
  </style>


</body>
</html>